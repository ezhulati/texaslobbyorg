PRIMARY AUDIENCE SEGMENTS
Segment 1: Business Owners & Executives
Who they are:

CEOs, business owners, corporate executives in Texas
Managing businesses affected by state legislation (healthcare, energy, real estate, tech, etc.)
Revenue: $5M-$500M+ companies

Their problem:

Need to influence Texas legislation that affects their business
Don't know how lobbying works or if they even need it
Don't know which lobbyist specializes in their industry
Fear of wasting money on the wrong lobbyist or getting scammed

The villain:

Opaque, insider-only political system that feels rigged against outsiders
Legislation passing that hurts their business because they had no voice
Competitors who ARE lobbying getting favorable treatment
The "good ol' boys club" they can't access

How the villain makes them feel:

Powerless and excluded from decisions affecting their livelihood
Frustrated that they're playing by the rules but losing anyway
Anxious about regulatory changes they can't predict or influence
Intimidated by the political process

How we help (as the guide):

Demystify lobbying: "Here's exactly how it works in Texas"
Show them who represents their industry and has a track record
Filter by their specific needs (industry, city, client history)
Transparent pricing and process expectations
Give them confidence: "You deserve a seat at the table"


Segment 2: Nonprofit Leaders & Advocacy Groups
Who they are:

Executive directors of nonprofits, advocacy organizations, trade associations
Fighting for policy changes (education reform, healthcare access, environmental protection)
Limited budgets, need cost-effective lobbying

Their problem:

Need to influence legislation on limited budgets
Don't know which lobbyists align with their values or have relevant experience
Fear hiring someone who represents conflicting interests
Need to justify lobbying spend to board/donors

The villain:

Well-funded corporate interests drowning out their voice
Legislators who don't understand or care about their cause
Lobbyists who talk a big game but don't deliver results
Competing nonprofits getting policy wins while they get ignored

How the villain makes them feel:

Outmatched and outgunned by bigger players
Guilty spending donor money on something that might not work
Desperate to prove their cause matters
Worried they're failing the people they serve

How we help:

Show client conflicts upfront: "Here's who they can't represent"
Filter by subject area expertise and past nonprofit clients
Transparent track record: see their actual legislative wins
Compare options side-by-side to maximize limited budgets
Educational content: "How to hire a lobbyist on a nonprofit budget"


Segment 3: Individual Citizens & Community Leaders
Who they are:

Concerned citizens affected by local/state issues
Community organizers, neighborhood association leaders
First-time seekers of political representation

Their problem:

Something happening in their community (zoning, development, school policies)
Don't know if lobbying is even for "regular people"
Assume it's too expensive or only for corporations
Don't know where to start

The villain:

Feeling like "little people" whose voices don't matter
Developers, corporations, government bulldozing their concerns
Belief that politics is corrupt and they can't win
Complexity and bureaucracy that keeps them out

How the villain makes them feel:

Ignored and disrespected by those in power
Angry at injustice but helpless to fix it
Cynical about whether anything will change
Intimidated by legal/political jargon

How we help:

Education: "Yes, you CAN hire a lobbyist - here's how"
Find local lobbyists who work on community issues
Show success stories from citizens who won
Demystify costs and process
Empower them: "Your voice matters, and here's how to amplify it"


THE CORE MESSAGE (GUIDE'S VOICE)
Positioning:
"Texas politics shouldn't be a mystery or a closed club. Whether you're a business owner, nonprofit leader, or concerned citizen, you have the right to be heard. We make it simple to find the right lobbyist, understand how the process works, and ensure your interests are represented in Austin."
Tone:

Straight-talking, no BS
Empowering, not patronizing
Texan (confident, direct, friendly)
Educational without being preachy
Insider knowledge made accessible


KEY QUESTIONS FOR YOU:

Which segment is PRIMARY? All three are valid, but who do you want to serve MOST? (This affects everything from pricing strategy to content priorities)
What's our stance on lobbying ethics? Do we take a position on "good" vs "bad" lobbying, or are we neutral platform connecting supply and demand?
Geographic scope: Texas-only forever, or is this a model we could expand to other states?
Competitive differentiation: What exists now that we're replacing/improving? (I assume people currently find lobbyists through word-of-mouth, law firm websites, or Texas Ethics Commission raw data)

Answer these and we're at 99.99% clarity on WHO and WHY. Then we can finalize the WHAT and HOW.
 The most important thing you can do to grow your business is use the right words to talk about your business and to talk about your products. If you use the wrong words, you will confuse customers, their eyes will glaze over, and they will pass you up and they will go to your competition. The wordpastedHeres how we want to position everythingPerfect. This clarifies everything. Let me synthesize this with our lobbyist directory:

THE STORY FOR TEXASLOBBY.ORG
THE HERO (Our Customer)
Business owners, nonprofit leaders, and concerned citizens in Texas who need legislative influence but feel locked out of the political process.
WHAT THEY WANT
To influence Texas legislation that affects their business, community, or cause.
THE PROBLEM

External/Villain: The opaque, insider-only Texas political system that feels rigged against outsiders. Legislation passes that hurts their interests because they had no voice. Competitors who ARE lobbying get favorable treatment while they get left behind.
Internal/How it makes them feel: Powerless, excluded, frustrated, anxious, intimidated by the "good ol' boys club" they can't access. Feel like their voice doesn't matter.
Philosophical/Why it's wrong: In a democracy, access to representation shouldn't be reserved for insiders. Every Texan deserves a seat at the table when laws are made that affect their livelihood.

THE GUIDE (Us - TexasLobby.org)
Empathy Statement:
"We know how frustrating it is when legislation passes that hurts your business while you're on the sidelines. You shouldn't need insider connections to have a voice in Austin."
Competency Statement:
"We've helped hundreds of Texas businesses, nonprofits, and citizens find the right lobbyist and navigate the legislative process. We make the system transparent."
THE PLAN (3 Steps)

Search by your needs - Filter by industry, location, and expertise to find lobbyists who specialize in your issue
See their track record - Review their clients, legislative wins, and conflicts to make an informed choice
Connect and get represented - Reach out directly, claim your voice in Austin

THE CALL TO ACTION
Direct CTA:
"If you need influence in Texas politics, finding the right lobbyist is the right decision."
Transitional CTA (softer):
"Download our free guide: How Lobbying Actually Works in Texas"
SUCCESS (What life looks like after)

Your interests are represented when legislation is drafted
You have a professional advocate who knows how Austin works
You stop losing to competitors who have political influence
You can focus on your business while someone fights for you in the capitol
You get a seat at the table

FAILURE (What life looks like if you don't)

Legislation passes that kills your business model or increases costs
Your competitors gain unfair advantages through political connections
You watch your industry get regulated out of existence
Years from now, you'll say "I should have gotten involved when I had the chance"


KEY SOUNDBITES FOR THE SITE
Tagline/Controlling Idea:
"Find Your Voice in Texas Politics"
One-Liner:
"Texas businesses and nonprofits struggle to influence legislation that affects them. TexasLobby.org makes it simple to find experienced lobbyists by industry and location, so you can have a voice in Austin."
Problem Statement:
"Most Texans don't know how to influence state legislation, even when it directly affects their business or community. The system feels closed to outsiders."
Solution Statement:
"We created the most comprehensive directory of Texas lobbyists, with transparent information about their expertise, clients, and track record—so you can find the right advocate for your needs."

MESSAGING HIERARCHY
Curiosity (Homepage/Top of Funnel):

Hero headline: "Find Your Voice in Texas Politics"
Subhead: "Connect with experienced lobbyists who fight for your interests in Austin"
Search bar: "Search by city, industry, or issue"

Enlightenment (Educational Content):

"How Lobbying Works in Texas" (mini book/PDF)
"What Does a Lobbyist Actually Cost?" (guide)
"5 Signs Your Business Needs a Lobbyist" (blog)
"Understanding Texas Ethics Commission Rules" (explainer)
City-specific: "Healthcare Lobbying in Austin: A Complete Guide"

Call to Action (Bottom of Funnel):

Lobbyist profiles: "Schedule a consultation with [Name]"
Throughout site: "If you need legislative influence in Texas, hiring a lobbyist is the right decision"
For lobbyists: "Claim your listing and connect with clients who need you"


FINAL CRITICAL QUESTIONS:

Primary audience priority: Based on StoryBrand framework, we should pick ONE primary hero. My recommendation: Business Owners (Segment 1) because they have the highest ability to pay and clearest ROI. Nonprofits and citizens become secondary audiences. Agree?
Monetization clarity: Lobbyists pay for featured placement. Are we ALSO charging businesses to access the directory, or is directory access free and lobbyists pay for visibility?
Our ethical stance: Are we neutral ("we connect you with lobbyists, what you lobby for is your business") or do we take a position ("we believe in transparent, ethical lobbying")?
Geographic expansion: Start Texas-only, but build with scalability in mind for other states?

Answer these 4 and we're at 99.99% clarity to hand this to Claude Code.Business Owners (Segment 1)Do you have other ideas for moneytization that make sense?neutraljust texas its texaslobby.orgMONETIZATION OPTIONS FOR TEXASLOBBY.ORG
Let me think through revenue streams that align with our business owner audience and neutral positioning:

PRIMARY REVENUE (Lobbyist-Paid)
1. Featured Placement Tiers

Basic Listing: Free (name, contact, basic info)
Premium Listing ($297/mo): Enhanced profile, client testimonials, case studies, priority in search results
Featured Listing ($597/mo): Homepage placement, top of category pages, "Featured" badge, analytics dashboard
Sponsored Category ($997/mo): Own the top spot for specific searches (e.g., "Healthcare Lobbyist in Houston")

Why this works: Lobbyists compete for visibility. The ones doing well can afford it, and it directly drives them client leads.

SECONDARY REVENUE (Business Owner Side)
2. Premium Research Reports ($49-$199 one-time)

"2024 Texas Legislative Outlook for [Industry]"
"Complete Guide to Healthcare Lobbying in Texas"
"Understanding Texas Environmental Regulations"
Industry-specific deep dives that businesses would pay for

Why this works: Business owners need intel before hiring a lobbyist. Positions us as the authority.
3. Consultation Matching Service ($500-$1000 fee)

"Not sure which lobbyist is right for you? We'll analyze your needs and connect you with 3 pre-vetted options"
White-glove concierge service for busy executives
We take a one-time placement fee (like a recruiter)

Why this works: High-value businesses don't want to research—they want an expert to tell them "hire this person."
4. Annual Access Pass for Multi-Location Businesses ($999/year)

Unlimited saved searches, alerts when new lobbyists join in their industry
Comparison tools to evaluate multiple lobbyists
Priority access to new reports and guides

Why this works: Franchises, multi-location healthcare groups, real estate developers need lobbying in multiple cities.

TERTIARY REVENUE (Ecosystem Building)
5. Sponsored Educational Content

Law firms, consulting firms, trade associations sponsor guides
"This guide to Texas nonprofit lobbying brought to you by [Law Firm]"
Must be clearly labeled as sponsored, maintain editorial independence

Why this works: Adjacent service providers want access to our audience without being sleazy.
6. Events & Webinars ($99-$499 ticket)

"Texas Legislative Session Preview for Business Owners"
"Networking Night: Meet Austin Lobbyists"
Virtual workshops: "DIY Lobbying for Small Businesses"

Why this works: Positions us as community hub, creates in-person trust, additional revenue stream.
7. Job Board for Lobbying Firms ($199/post)

Lobbying firms hiring? Post openings on our site
We have the exact audience they want to recruit from

Why this works: Lobbying firms struggle to find talent. We aggregate the industry.
8. API Access for Researchers/Media ($499/mo)

Journalists, academics, watchdog groups pay for structured data access
All public Texas Ethics Commission data, just easier to use

Why this works: Media organizations would pay for clean, searchable data vs. dealing with terrible government websites.

REVENUE MODEL COMPARISON
ModelEffort to BuildMonthly PotentialScalabilityRiskFeatured ListingsLow$10K-50KHighLowPremium ReportsMedium$2K-10KMediumLowConsultation MatchingHigh$5K-20KLowMediumAnnual Access PassMedium$5K-15KHighLowSponsored ContentLow$2K-5KMediumMediumEvents/WebinarsHigh$3K-10KLowMediumJob BoardLow$1K-3KHighLowAPI AccessMedium$2K-5KMediumLow

MY RECOMMENDATION: PHASED APPROACH
Phase 1 (Launch - Month 1-3): Foundation

Free basic listings for all lobbyists
Premium listing ($297/mo) and Featured listing ($597/mo) available immediately
One free lead magnet: "Complete Guide to Hiring a Texas Lobbyist" (PDF)

Goal: Get 100+ lobbyists signed up, establish market presence, prove concept
Phase 2 (Month 4-6): Expand Value

Launch 3 premium research reports ($99-$199 each)
Add Sponsored Category option ($997/mo) for high-value keywords
Start building email list of business owners searching the site

Goal: Diversify revenue beyond just listing fees, build authority
Phase 3 (Month 7-12): Premium Services

Launch consultation matching service ($500-$1000 placement fee)
Create Annual Access Pass for enterprises ($999/year)
Host first virtual event/webinar

Goal: Move upmarket, serve larger clients with higher budgets
Phase 4 (Year 2+): Ecosystem

Sponsored content from adjacent service providers
Job board for lobbying industry
API access for media/researchers
In-person networking events in major metros

Goal: Become the central hub for Texas lobbying ecosystem

FINANCIAL PROJECTIONS (Conservative)
Year 1 Revenue Estimate:

50 Premium Listings @ $297/mo = $178K/year
20 Featured Listings @ $597/mo = $143K/year
5 Sponsored Categories @ $997/mo = $60K/year
Premium Reports: $10K/year
Total Year 1: ~$391K

Year 2 Revenue Estimate:

100 Premium Listings = $356K
40 Featured Listings = $286K
10 Sponsored Categories = $120K
Premium Reports: $25K
Consultation Matching: $30K
Annual Access Pass: $20K
Events: $15K
Total Year 2: ~$852K


QUESTIONS FOR YOU:

Which monetization options resonate most with you? (I recommend starting with Featured Listings + Premium Reports)
Pricing philosophy: Are we premium-priced (positioning as the authoritative source) or accessible-priced (volume play)? I lean premium given our B2B audience.
Lobbyist acquisition: How do we get the first 50-100 lobbyists to sign up? Cold outreach, ads, partnerships with Texas bar associations?
Business owner acquisition: How do we drive traffic? SEO (takes 6-12 months), Google Ads (expensive for "lobbyist" keywords), content marketing, PR?
Competition check: Have you researched if anyone else is doing this in Texas? What exists now that we're disrupting?

Answer these and we can build the exact product roadmap and go-to-market strategy for Claude Code to execute.Featured ListingspremiumSEO and outreach and ads maybeproper seo with schema for maximum discoveryyes there is one site https://txlobbyguide.com/ but it looks datedPerfect. Let me analyze the competitor and finalize our strategy.txlobbyguide.com Texas lobbyist directoryCOMPETITIVE ANALYSIS: TXLobbyGuide.com
Based on what you've shared, their weaknesses are our opportunities:
Their Weaknesses (Our Advantages)

Dated design → We build modern, mobile-first with shadcn/ui
Likely poor SEO → We dominate with schema markup, city pages, educational content
No StoryBrand messaging → They talk about themselves, we talk about the hero's problem
Probably no localized search → We own "lobbyist near me" + every Texas city
No educational content → We become the authority on "how lobbying works in Texas"


FINAL STRATEGY BLUEPRINT
PHASE 1: FOUNDATION (Months 1-3)
Product:

Astro + React + Tailwind + shadcn/ui
Database: Supabase (auth built-in, PostgreSQL, real-time)
Hosting: Netlify
Payments: Stripe
Email: Resend or SendGrid
Analytics: Plausible (privacy-focused)

Data Structure:
Lobbyists Table:
- id, name, business_type, bio, email, phone
- office_address (street, city, state, zip)
- cities_served[] (array - for multi-city visibility)
- subject_areas[] (array)
- clients[] (array with client name, dates)
- compensation_ranges
- listing_tier (free, premium, featured)
- claimed (boolean)
- profile_image, website, linkedin

Cities Table:
- id, name, slug, region, population
- meta_title, meta_description (for SEO)

Subject_Areas Table:
- id, name, slug, description

Searches Table (user saved searches):
- user_id, query, filters, created_at

Users Table:
- Business owners (for favorites)
- Lobbyists (for claiming/editing)
Core Features - Launch:

Search/filter by: city, subject area, client type
Lobbyist profile pages (schema.org markup)
City landing pages (e.g., /houston-lobbyists)
Subject landing pages (e.g., /healthcare-lobbyists)
Authentication (email/password, magic link, Google)
Claim listing flow for lobbyists
Edit profile (lobbyists only, after claiming)
Featured listing purchase flow (Stripe)

Content - Launch:

Homepage with StoryBrand messaging
"How Lobbying Works in Texas" (comprehensive guide)
"How to Hire a Lobbyist" (lead magnet PDF)
5 major city pages (Houston, Dallas, Austin, San Antonio, Fort Worth)
10 subject area pages (Healthcare, Energy, Education, Real Estate, etc.)

SEO Technical:

Schema.org markup: LocalBusiness, Person, ProfessionalService
OpenGraph tags for social sharing
Sitemap.xml with priority weighting
Robots.txt optimized
Core Web Vitals optimized (Astro is fast by default)
Internal linking structure: City ↔ Lobbyist ↔ Subject Area

Launch Goals:

50 lobbyists signed up (25 premium, 5 featured)
100 organic visits/day by Month 3
5 paid listings = $1,485/mo recurring revenue


PHASE 2: GROWTH (Months 4-9)
Product Additions:

User accounts for business owners (save favorites, comparison tool)
Advanced filters (compensation range, years experience, client conflicts)
"Request consultation" contact forms on profiles
Analytics dashboard for featured lobbyists (views, clicks, inquiries)
Automated email alerts ("New healthcare lobbyist in Austin")

Content Expansion:

20 additional city pages (all major metros + suburbs)
15 more subject area pages
Blog: 2 posts/week (SEO-driven topics)
Case studies: "How [Business] Used a Lobbyist to Save $500K"
FAQ hub: 50 common questions answered

SEO Tactics:

Target long-tail: "how much does a lobbyist cost in texas"
Build backlinks: Texas business publications, chambers of commerce
Guest posts on Texas business blogs
Directory submissions (Yelp, Google Business Profile)
Schema markup expansion: FAQPage, HowTo, Article

Growth Goals:

150 lobbyists signed up (60 premium, 15 featured)
500 organic visits/day
$30K/mo recurring revenue


PHASE 3: DOMINANCE (Months 10-18)
Product Maturity:

Premium research reports marketplace
Sponsored category placements
Advanced comparison tools
Mobile app (PWA first, then native if needed)
API for researchers/media

Content Authority:

"State of Texas Lobbying" annual report
Video content: interviews with lobbyists, explainer series
Webinar series: "Legislative Session Preview"
Email newsletter: 10K+ subscribers

SEO Domination:

Rank #1 for all target keywords
100+ city pages (every incorporated city in Texas)
50+ subject area pages (every niche)
Featured snippets captured for question queries
E-E-A-T signals: Press mentions, author bios, credentials

Goals:

300+ lobbyists (150 premium, 30 featured)
2,000 organic visits/day
$75K/mo recurring revenue
Market leader position established


GO-TO-MARKET: LOBBYIST ACQUISITION
Month 1: Seed the Database

Import all 1,687 lobbyists from Texas Ethics Commission data
Create free basic profiles for everyone (public data only)
Email campaign: "We've created a profile for you - claim it for free"
LinkedIn outreach to top 100 lobbyists

Month 2-3: Premium Push

Cold email sequence to lobbyists:

Email 1: "Your free profile is live on TexasLobby.org"
Email 2: "3 business owners viewed your profile this week" (social proof)
Email 3: "Upgrade to Premium and get 3X more visibility" (offer)


Phone outreach to top 50 lobbyists (personal touch)
LinkedIn Ads targeting: Title "Lobbyist" + Location "Texas"

Messaging for Lobbyists:

Problem: "You're losing clients to lobbyists who are easier to find online"
Solution: "Featured placement on TexasLobby.org puts you in front of businesses actively looking for representation"
CTA: "Claim your profile and upgrade to Featured for $597/mo"


GO-TO-MARKET: BUSINESS OWNER ACQUISITION
SEO (Primary - 6-12 month payoff):

Target keywords:

"lobbyist in [city]" (480 searches/mo combined)
"how to hire a lobbyist" (720 searches/mo)
"texas lobbyist directory" (390 searches/mo)
"what does a lobbyist cost" (210 searches/mo)


Content strategy: Answer every question a business owner has
Backlink strategy: PR, guest posts, business directories

Google Ads (Immediate, but expensive):

Budget: $3K-5K/mo to start
Target: "hire lobbyist texas", "texas lobbyist [city]", "lobbying services texas"
Landing pages: City-specific (e.g., "Find Houston Lobbyists")
Goal: $50 CPA for lead magnet download, nurture to lobbyist inquiry

Outreach/Partnerships:

Texas chambers of commerce (guest speaking, sponsor newsletter)
Industry associations (Texas Restaurant Association, Texas Medical Association)
Business publications (Texas CEO Magazine, Houston Chronicle Business)
Accountants/lawyers (referral partnerships)

PR Strategy:

Launch announcement: "New Platform Makes Texas Lobbying Transparent"
Pitch to Texas business reporters
Controversial angle: "Why Your Competitors Are Lobbying and You're Not"


TECHNICAL SEO REQUIREMENTS FOR CLAUDE CODE
Schema Markup (Critical):
json{
  "@context": "https://schema.org",
  "@type": "ProfessionalService",
  "name": "TexasLobby.org",
  "description": "Find experienced Texas lobbyists by city and specialty",
  "url": "https://texaslobby.org",
  "sameAs": ["https://twitter.com/texaslobby", "https://linkedin.com/company/texaslobby"]
}

// Lobbyist profiles:
{
  "@type": "Person",
  "name": "Sean Abbott",
  "jobTitle": "Attorney and Lobbyist",
  "worksFor": {
    "@type": "Organization",
    "name": "Abbott Lobbying"
  },
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Austin",
    "addressRegion": "TX"
  },
  "knowsAbout": ["Healthcare Policy", "Education Legislation"]
}

// City pages:
{
  "@type": "ItemList",
  "name": "Austin Lobbyists",
  "itemListElement": [...]
}
```

**URL Structure:**
```
/ (homepage)
/lobbyists (directory - all lobbyists)
/lobbyists/[slug] (individual profile)
/cities (all cities)
/cities/[city-slug] (e.g., /cities/houston)
/cities/[city-slug]/[subject-slug] (e.g., /cities/houston/healthcare)
/subjects (all subject areas)
/subjects/[subject-slug] (e.g., /subjects/healthcare)
/guides (educational content hub)
/guides/[slug] (individual guides)
/pricing (for lobbyists)
/claim (claim listing flow)
/login & /signup
/dashboard (for logged-in users)
Meta Tag Template:
html<!-- City page example -->
<title>Houston Lobbyists | Find Texas Lobbying Services in Houston</title>
<meta name="description" content="Connect with experienced lobbyists in Houston, TX. Compare specialties, clients, and track records. Find the right advocate for your business.">

<!-- Lobbyist profile example -->
<title>Sean Abbott - Austin Healthcare Lobbyist | TexasLobby.org</title>
<meta name="description" content="Sean Abbott is an attorney and lobbyist in Austin specializing in healthcare policy. View client list, subject areas, and contact information.">

DESIGN SYSTEM (shadcn/ui + Tailwind)
Brand Colors (Texas Politics Theme):

Primary: Deep Texas Blue (#003f87) - authority, trust
Secondary: Lone Star Red (#bf0a30) - action, urgency
Accent: Austin Sage (#8b9474) - modern, approachable
Neutral: Warm grays (#f5f5f4 to #1c1917)

Typography:

Headings: Inter or Poppins (modern, professional)
Body: System font stack (performance)

Key Components:

Search bar (prominent on homepage)
Filter sidebar (checkboxes for multi-select)
Lobbyist card (image, name, location, subjects, "Featured" badge)
Comparison table (side-by-side lobbyist comparison)
Profile layout (hero section, tabs for About/Clients/Contact)


FINAL DECISION POINTS:

Launch timeline: How fast do you want to move?

Aggressive (6 weeks to MVP)
Moderate (3 months to polished launch)
Conservative (6 months with all features)


Initial budget for ads/outreach: $5K? $10K? $25K?
Are YOU doing the outreach to lobbyists, or hiring someone?
Content creation: Are you writing guides yourself, hiring writers, or AI + human editing?
Legal: Do we need terms of service reviewed by lawyer? (Probably yes for payment processing)

Once you answer these, I'll create the complete technical specification document for Claude Code to build this end-to-end.
Ready to pull the trigger?Imagine you are the head product manager and you have to create documentation for the lead  engineer to make this A to Z. What would those documents be? timelines arent neededTEXASLOBBY.ORG - COMPLETE PRODUCT DOCUMENTATION
For Lead Engineer: Claude Code

TABLE OF CONTENTS

Product Requirements Document (PRD)
Technical Specification Document
Database Schema & Data Models
API Specification
UI/UX Design System
User Stories & Acceptance Criteria
SEO & Content Requirements
Integration Requirements
Security & Compliance
Testing Requirements
Deployment & DevOps
Analytics & Tracking


1. PRODUCT REQUIREMENTS DOCUMENT
1.1 PRODUCT VISION
Mission Statement:
Make Texas lobbying accessible and transparent by connecting business owners with experienced lobbyists through a modern, searchable directory.
Target Audience:

Primary: Texas business owners ($5M-$500M+ revenue) who need legislative influence
Secondary: Lobbyists seeking client visibility and lead generation

Value Proposition:
"Find Your Voice in Texas Politics - Connect with experienced lobbyists who fight for your interests in Austin"
1.2 BUSINESS MODEL
Revenue Streams:

Premium Listing: $297/month - Enhanced profile, priority in search
Featured Listing: $597/month - Homepage placement, top of search results, analytics
Sponsored Category: $997/month - Own top spot for specific keyword/category searches

Success Metrics:

300+ lobbyists signed up within Year 1
50% of lobbyists on paid plans
2,000+ organic visits/day by Month 18
$75K/month recurring revenue by Month 18

1.3 CORE FEATURES (MVP)
For Business Owners (Searchers):

Search lobbyists by city, subject area, and keyword
Filter by multiple criteria simultaneously
View lobbyist profiles with full transparency
Save favorite lobbyists (requires login)
Download educational guides (lead magnets)
Compare multiple lobbyists side-by-side

For Lobbyists (Listing Owners):

Claim existing profile created from public data
Edit profile information (contact, bio, expertise)
Upgrade to Premium or Featured listing
View analytics dashboard (Featured only)
Manage subscription and billing

For Admin:

Approve/reject profile edits (if needed)
Manage featured placements
View platform analytics
Manage content (guides, blog posts)

1.4 OUT OF SCOPE (For MVP)

Native mobile apps (PWA only)
Review/rating system for lobbyists
Direct messaging between users and lobbyists
Video uploads
Multi-language support
Advanced AI matching algorithms


2. TECHNICAL SPECIFICATION DOCUMENT
2.1 TECHNOLOGY STACK
Frontend:

Framework: Astro 4.x (static site generation + islands architecture)
UI Library: React 18+ (for interactive islands)
Styling: Tailwind CSS 3.x + shadcn/ui components
Forms: React Hook Form + Zod validation
State Management: Zustand (minimal, only where needed)
Icons: Lucide React

Backend:

Database: Supabase (PostgreSQL + Auth + Storage)
API: Supabase REST API + Row Level Security (RLS)
File Storage: Supabase Storage (for profile images)
Auth: Supabase Auth (email/password, magic links, Google OAuth)

Payments:

Provider: Stripe
Implementation: Stripe Checkout (hosted) + Customer Portal
Webhooks: For subscription management

Email:

Transactional: Resend or SendGrid
Marketing: ConvertKit or Mailchimp (via API)

Hosting & Deployment:

Platform: Netlify
CDN: Netlify Edge (built-in)
Domain: texaslobby.org
SSL: Automatic via Netlify

Analytics:

Privacy-focused: Plausible Analytics
Google Search Console: For SEO monitoring
Stripe Dashboard: For revenue analytics

Development Tools:

Version Control: Git + GitHub
Package Manager: pnpm
Linting: ESLint + Prettier
Type Safety: TypeScript throughout

2.2 ARCHITECTURE OVERVIEW
┌─────────────────────────────────────────────────────────────┐
│                         FRONTEND                             │
│  (Astro + React Islands + Tailwind + shadcn/ui)            │
│                                                              │
│  Pages (Static):                                            │
│  - Homepage, City pages, Subject pages, Guides             │
│                                                              │
│  Islands (Interactive React):                               │
│  - Search/Filter component                                  │
│  - Auth forms (Login/Signup)                               │
│  - Dashboard (user/lobbyist)                               │
│  - Comparison tool                                          │
│  - Profile edit forms                                       │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ REST API / Real-time subscriptions
                       │
┌──────────────────────▼──────────────────────────────────────┐
│                      SUPABASE                                │
│                                                              │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  PostgreSQL │  │  Supabase    │  │  Supabase    │      │
│  │  Database   │  │  Auth        │  │  Storage     │      │
│  └─────────────┘  └──────────────┘  └──────────────┘      │
│                                                              │
│  Row Level Security (RLS) enforced on all tables           │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ Webhooks
                       │
┌──────────────────────▼──────────────────────────────────────┐
│                  EXTERNAL SERVICES                           │
│                                                              │
│  ┌──────────┐  ┌─────────┐  ┌──────────┐  ┌──────────┐   │
│  │  Stripe  │  │  Resend │  │ Plausible│  │  Google  │   │
│  │ Payments │  │  Email  │  │ Analytics│  │  OAuth   │   │
│  └──────────┘  └─────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
2.3 FOLDER STRUCTURE
texaslobby.org/
├── src/
│   ├── components/
│   │   ├── react/              # Interactive React islands
│   │   │   ├── SearchFilter.tsx
│   │   │   ├── LobbyistCard.tsx
│   │   │   ├── AuthForms.tsx
│   │   │   ├── Dashboard.tsx
│   │   │   └── ComparisonTool.tsx
│   │   ├── ui/                 # shadcn/ui components
│   │   │   ├── button.tsx
│   │   │   ├── card.tsx
│   │   │   ├── input.tsx
│   │   │   └── ...
│   │   └── astro/              # Astro components
│   │       ├── Header.astro
│   │       ├── Footer.astro
│   │       ├── SEO.astro
│   │       └── Layout.astro
│   ├── pages/
│   │   ├── index.astro         # Homepage
│   │   ├── lobbyists/
│   │   │   ├── index.astro     # All lobbyists
│   │   │   └── [slug].astro    # Individual profile
│   │   ├── cities/
│   │   │   ├── index.astro     # All cities
│   │   │   ├── [city].astro    # City landing page
│   │   │   └── [city]/[subject].astro
│   │   ├── subjects/
│   │   │   ├── index.astro
│   │   │   └── [subject].astro
│   │   ├── guides/
│   │   │   ├── index.astro
│   │   │   └── [slug].astro
│   │   ├── pricing.astro
│   │   ├── claim.astro
│   │   ├── login.astro
│   │   ├── signup.astro
│   │   └── dashboard.astro
│   ├── lib/
│   │   ├── supabase.ts         # Supabase client
│   │   ├── stripe.ts           # Stripe client
│   │   ├── utils.ts            # Helper functions
│   │   └── schemas.ts          # Zod schemas
│   ├── types/
│   │   └── index.ts            # TypeScript types
│   ├── content/                # Markdown content
│   │   ├── config.ts
│   │   └── guides/
│   ├── styles/
│   │   └── global.css
│   └── env.d.ts
├── public/
│   ├── images/
│   ├── fonts/
│   └── favicon.ico
├── supabase/
│   ├── migrations/             # Database migrations
│   └── seed.sql               # Seed data
├── .env.example
├── astro.config.mjs
├── tailwind.config.mjs
├── tsconfig.json
├── package.json
└── README.md
2.4 PERFORMANCE REQUIREMENTS

Lighthouse Score: 90+ across all metrics
Time to Interactive (TTI): < 3 seconds on 4G
First Contentful Paint (FCP): < 1.5 seconds
Largest Contentful Paint (LCP): < 2.5 seconds
Image optimization: WebP format, lazy loading, responsive images
Code splitting: Islands architecture for minimal JS
Caching: Static pages cached at CDN edge

2.5 BROWSER SUPPORT

Chrome (last 2 versions)
Firefox (last 2 versions)
Safari (last 2 versions)
Edge (last 2 versions)
Mobile Safari iOS 14+
Chrome Android (last 2 versions)


3. DATABASE SCHEMA & DATA MODELS
3.1 ENTITY RELATIONSHIP DIAGRAM
┌─────────────────┐
│     users       │
├─────────────────┤
│ id (uuid) PK    │
│ email           │
│ role            │◄────────────┐
│ created_at      │             │
└─────────────────┘             │
                                │
┌─────────────────────────────┐ │
│       lobbyists             │ │
├─────────────────────────────┤ │
│ id (uuid) PK                │ │
│ user_id (uuid) FK ──────────┘
│ filer_id                    │
│ name                        │
│ business_type               │
│ bio                         │
│ email                       │
│ phone                       │
│ website                     │
│ linkedin                    │
│ profile_image_url           │
│ office_address              │◄────┐
│ office_city_id (int) FK ────┼─────┼─────┐
│ office_state                │     │     │
│ office_zip                  │     │     │
│ cities_served[] (int[])     │     │     │
│ subject_areas[] (int[])     │     │     │
│ listing_tier                │     │     │
│ stripe_customer_id          │     │     │
│ stripe_subscription_id      │     │     │
│ claimed                     │     │     │
│ verified                    │     │     │
│ created_at                  │     │     │
│ updated_at                  │     │     │
└─────────────────────────────┘     │     │
                                    │     │
┌──────────────────────────┐        │     │
│        cities            │        │     │
├──────────────────────────┤        │     │
│ id (int) PK              │◄───────┘     │
│ name                     │              │
│ slug                     │              │
│ region                   │              │
│ population               │              │
│ meta_title               │              │
│ meta_description         │              │
│ content                  │              │
└──────────────────────────┘              │
                                          │
┌──────────────────────────┐              │
│    subject_areas         │              │
├──────────────────────────┤              │
│ id (int) PK              │◄─────────────┘
│ name                     │
│ slug                     │
│ description              │
│ meta_title               │
│ meta_description         │
│ icon                     │
└──────────────────────────┘

┌─────────────────────────┐      ┌─────────────────┐
│      clients            │      │   users         │
├─────────────────────────┤      └─────────────────┘
│ id (uuid) PK            │               │
│ lobbyist_id (uuid) FK   │───┐           │
│ name                    │   │           │
│ start_date              │   │           │
│ end_date                │   │           │
│ is_active               │   │           │
└─────────────────────────┘   │           │
           ▲                  │           │
           │                  │           │
           │                  │           │
┌──────────┴────────────┐     │           │
│   lobbyists           │◄────┘           │
└───────────────────────┘                 │
                                          │
┌─────────────────────────────┐           │
│      favorites              │           │
├─────────────────────────────┤           │
│ id (uuid) PK                │           │
│ user_id (uuid) FK ──────────┼───────────┘
│ lobbyist_id (uuid) FK       │
│ created_at                  │
└─────────────────────────────┘

┌─────────────────────────────┐
│      searches               │
├─────────────────────────────┤
│ id (uuid) PK                │
│ user_id (uuid) FK           │
│ query                       │
│ filters (jsonb)             │
│ created_at                  │
└─────────────────────────────┘

┌─────────────────────────────┐
│      page_views             │
├─────────────────────────────┤
│ id (uuid) PK                │
│ lobbyist_id (uuid) FK       │
│ viewer_type                 │
│ referrer                    │
│ created_at                  │
└─────────────────────────────┘
3.2 TABLE DEFINITIONS
3.2.1 users
sqlCREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email TEXT UNIQUE NOT NULL,
  role TEXT NOT NULL CHECK (role IN ('searcher', 'lobbyist', 'admin')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS Policies
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
  ON users FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
  ON users FOR UPDATE
  USING (auth.uid() = id);
3.2.2 lobbyists
sqlCREATE TABLE lobbyists (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE SET NULL,
  filer_id TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  business_type TEXT,
  bio TEXT,
  email TEXT,
  phone TEXT,
  website TEXT,
  linkedin TEXT,
  profile_image_url TEXT,
  office_address TEXT,
  office_city_id INTEGER REFERENCES cities(id),
  office_state TEXT DEFAULT 'TX',
  office_zip TEXT,
  cities_served INTEGER[] DEFAULT '{}',
  subject_areas INTEGER[] DEFAULT '{}',
  listing_tier TEXT NOT NULL DEFAULT 'free' CHECK (listing_tier IN ('free', 'premium', 'featured')),
  stripe_customer_id TEXT,
  stripe_subscription_id TEXT,
  claimed BOOLEAN DEFAULT FALSE,
  verified BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_lobbyists_filer_id ON lobbyists(filer_id);
CREATE INDEX idx_lobbyists_office_city ON lobbyists(office_city_id);
CREATE INDEX idx_lobbyists_listing_tier ON lobbyists(listing_tier);
CREATE INDEX idx_lobbyists_claimed ON lobbyists(claimed);
CREATE INDEX idx_lobbyists_cities_served ON lobbyists USING GIN(cities_served);
CREATE INDEX idx_lobbyists_subject_areas ON lobbyists USING GIN(subject_areas);

-- Full text search
ALTER TABLE lobbyists ADD COLUMN search_vector tsvector;
CREATE INDEX idx_lobbyists_search ON lobbyists USING GIN(search_vector);

CREATE FUNCTION update_lobbyist_search_vector() RETURNS trigger AS $$
BEGIN
  NEW.search_vector := 
    setweight(to_tsvector('english', COALESCE(NEW.name, '')), 'A') ||
    setweight(to_tsvector('english', COALESCE(NEW.business_type, '')), 'B') ||
    setweight(to_tsvector('english', COALESCE(NEW.bio, '')), 'C');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_lobbyist_search_vector_trigger
  BEFORE INSERT OR UPDATE ON lobbyists
  FOR EACH ROW EXECUTE FUNCTION update_lobbyist_search_vector();

-- RLS Policies
ALTER TABLE lobbyists ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view lobbyists"
  ON lobbyists FOR SELECT
  USING (true);

CREATE POLICY "Lobbyists can update own profile"
  ON lobbyists FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Admins can update any lobbyist"
  ON lobbyists FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM users
      WHERE users.id = auth.uid()
      AND users.role = 'admin'
    )
  );
3.2.3 cities
sqlCREATE TABLE cities (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  region TEXT,
  population INTEGER,
  meta_title TEXT,
  meta_description TEXT,
  content TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_cities_slug ON cities(slug);
CREATE INDEX idx_cities_region ON cities(region);

-- RLS
ALTER TABLE cities ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view cities"
  ON cities FOR SELECT
  USING (true);
3.2.4 subject_areas
sqlCREATE TABLE subject_areas (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  description TEXT,
  meta_title TEXT,
  meta_description TEXT,
  icon TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_subject_areas_slug ON subject_areas(slug);

-- RLS
ALTER TABLE subject_areas ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view subject areas"
  ON subject_areas FOR SELECT
  USING (true);
3.2.5 clients
sqlCREATE TABLE clients (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  lobbyist_id UUID REFERENCES lobbyists(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  start_date DATE,
  end_date DATE,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_clients_lobbyist_id ON clients(lobbyist_id);
CREATE INDEX idx_clients_is_active ON clients(is_active);

-- RLS
ALTER TABLE clients ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view clients"
  ON clients FOR SELECT
  USING (true);

CREATE POLICY "Lobbyists can manage own clients"
  ON clients FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM lobbyists
      WHERE lobbyists.id = clients.lobbyist_id
      AND lobbyists.user_id = auth.uid()
    )
  );
3.2.6 favorites
sqlCREATE TABLE favorites (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  lobbyist_id UUID REFERENCES lobbyists(id) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, lobbyist_id)
);

-- Indexes
CREATE INDEX idx_favorites_user_id ON favorites(user_id);
CREATE INDEX idx_favorites_lobbyist_id ON favorites(lobbyist_id);

-- RLS
ALTER TABLE favorites ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own favorites"
  ON favorites FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can manage own favorites"
  ON favorites FOR ALL
  USING (auth.uid() = user_id);
3.2.7 searches
sqlCREATE TABLE searches (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  query TEXT,
  filters JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_searches_user_id ON searches(user_id);
CREATE INDEX idx_searches_created_at ON searches(created_at DESC);

-- RLS
ALTER TABLE searches ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own searches"
  ON searches FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can create own searches"
  ON searches FOR INSERT
  WITH CHECK (auth.uid() = user_id);
3.2.8 page_views
sqlCREATE TABLE page_views (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  lobbyist_id UUID REFERENCES lobbyists(id) ON DELETE CASCADE,
  viewer_type TEXT CHECK (viewer_type IN ('anonymous', 'authenticated')),
  referrer TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_page_views_lobbyist_id ON page_views(lobbyist_id);
CREATE INDEX idx_page_views_created_at ON page_views(created_at DESC);

-- RLS
ALTER TABLE page_views ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can create page views"
  ON page_views FOR INSERT
  WITH CHECK (true);

CREATE POLICY "Lobbyists can view own page views"
  ON page_views FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM lobbyists
      WHERE lobbyists.id = page_views.lobbyist_id
      AND lobbyists.user_id = auth.uid()
    )
  );
3.3 SEED DATA
Cities (Major Texas metros)
sqlINSERT INTO cities (name, slug, region, population, meta_title, meta_description) VALUES
('Houston', 'houston', 'Southeast Texas', 2304580, 'Houston Lobbyists | Find Legislative Advocates in Houston, TX', 'Connect with experienced lobbyists in Houston, Texas. Compare specialties, clients, and track records. Find the right advocate for your business.'),
('Dallas', 'dallas', 'North Texas', 1304379, 'Dallas Lobbyists | Find Legislative Advocates in Dallas, TX', 'Connect with experienced lobbyists in Dallas, Texas. Compare specialties, clients, and track records.'),
('Austin', 'austin', 'Central Texas', 961855, 'Austin Lobbyists | Find Legislative Advocates in Austin, TX', 'Connect with experienced lobbyists in Austin, Texas. Direct access to the state capitol.'),
('San Antonio', 'san-antonio', 'South Texas', 1547253, 'San Antonio Lobbyists | Find Legislative Advocates in San Antonio, TX', 'Connect with experienced lobbyists in San Antonio, Texas.'),
('Fort Worth', 'fort-worth', 'North Texas', 935508, 'Fort Worth Lobbyists | Find Legislative Advocates in Fort Worth, TX', 'Connect with experienced lobbyists in Fort Worth, Texas.');

-- Add more cities as needed
Subject Areas
sqlINSERT INTO subject_areas (name, slug, description, meta_title, meta_description, icon) VALUES
('Healthcare', 'healthcare', 'Healthcare policy, insurance, hospitals, medical devices, pharmaceuticals', 'Healthcare Lobbyists in Texas | Medical & Insurance Advocacy', 'Find Texas lobbyists specializing in healthcare policy, insurance, hospitals, and medical legislation.', 'heart-pulse'),
('Energy', 'energy', 'Oil & gas, renewable energy, utilities, environmental regulations', 'Energy Lobbyists in Texas | Oil, Gas & Renewable Energy', 'Find Texas lobbyists specializing in energy policy, oil and gas, renewable energy, and utilities.', 'zap'),
('Education', 'education', 'K-12, higher education, school finance, teacher issues', 'Education Lobbyists in Texas | School & University Advocacy', 'Find Texas lobbyists specializing in education policy, school finance, and higher education.', 'graduation-cap'),
('Real Estate', 'real-estate', 'Property rights, zoning, development, construction', 'Real Estate Lobbyists in Texas | Property & Development', 'Find Texas lobbyists specializing in real estate, property rights, zoning, and development.', 'building'),
('Transportation', 'transportation', 'Highways, public transit, autonomous vehicles, infrastructure', 'Transportation Lobbyists in Texas | Infrastructure & Transit', 'Find Texas lobbyists specializing in transportation, highways, and infrastructure.', 'car'),
('Technology', 'technology', 'Tech policy, data privacy, telecommunications, cybersecurity', 'Technology Lobbyists in Texas | Tech Policy & Data Privacy', 'Find Texas lobbyists specializing in technology policy, data privacy, and telecommunications.', 'laptop'),
('Agriculture', 'agriculture', 'Farming, ranching, water rights, rural development', 'Agriculture Lobbyists in Texas | Farming & Ranching Advocacy', 'Find Texas lobbyists specializing in agriculture, farming, ranching, and water rights.', 'wheat'),
('Business & Commerce', 'business-commerce', 'Business regulations, commerce, economic development', 'Business Lobbyists in Texas | Commerce & Economic Development', 'Find Texas lobbyists specializing in business regulations and economic development.', 'briefcase'),
('Insurance', 'insurance', 'Insurance regulations, workers comp, liability', 'Insurance Lobbyists in Texas | Regulatory & Policy Advocacy', 'Find Texas lobbyists specializing in insurance regulations and policy.', 'shield'),
('Legal & Judicial', 'legal-judicial', 'Court system, legal reform, tort reform', 'Legal Lobbyists in Texas | Judicial & Legal Reform', 'Find Texas lobbyists specializing in legal reform and judicial issues.', 'scale');

-- Add remaining subject areas from the data

4. API SPECIFICATION
4.1 SUPABASE CLIENT SETUP
typescript// src/lib/supabase.ts
import { createClient } from '@supabase/supabase-js';
import type { Database } from '@/types/database';

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

export const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey);

// Server-side client (for Astro API routes)
export const createServerClient = (request: Request) => {
  return createClient<Database>(supabaseUrl, supabaseAnonKey, {
    auth: {
      flowType: 'pkce',
      detectSessionInUrl: true,
      persistSession: true,
      storage: {
        getItem: (key) => {
          const cookies = request.headers.get('cookie');
          return cookies?.split('; ').find(c => c.startsWith(`${key}=`))?.split('=')[1];
        },
        setItem: (key, value) => {
          // Handle setting cookies in response
        },
        removeItem: (key) => {
          // Handle removing cookies
        }
      }
    }
  });
};
4.2 CORE API ENDPOINTS
4.2.1 Search & Filter Lobbyists
Function: searchLobbyists()
typescript// src/lib/api/lobbyists.ts
export async function searchLobbyists(params: {
  query?: string;
  cityIds?: number[];
  subjectAreaIds?: number[];
  listingTier?: string[];
  limit?: number;
  offset?: number;
}) {
  let queryBuilder = supabase
    .from('lobbyists')
    .select(`
      *,
      office_city:cities(name, slug),
      clients(name, is_active),
      page_views(count)
    `)
    .eq('claimed', true)
    .order('listing_tier', { ascending: false })
    .order('name', { ascending: true })
    .range(params.offset || 0, (params.offset || 0) + (params.limit || 20));

  // Full-text search
  if (params.query) {
    queryBuilder = queryBuilder.textSearch('search_vector', params.query);
  }

  // Filter by cities
  if (params.cityIds && params.cityIds.length > 0) {
    queryBuilder = queryBuilder.overlaps('cities_served', params.cityIds);
  }

  // Filter by subject areas
  if (params.subjectAreaIds && params.subjectAreaIds.length > 0) {
    queryBuilder = queryBuilder.overlaps('subject_areas', params.subjectAreaIds);
  }

  // Filter by listing tier
  if (params.listingTier && params.listingTier.length > 0) {
    queryBuilder = queryBuilder.in('listing_tier', params.listingTier);
  }

  const { data, error, count } = await queryBuilder;

  if (error) throw error;

  return { lobbyists: data, total: count };
}
4.2.2 Get Lobbyist Profile
typescriptexport async function getLobbyistBySlug(slug: string) {
  const { data, error } = await supabase
    .from('lobbyists')
    .select(`
      *,
      office_city:cities(name, slug, region),
      clients(name, start_date, end_date, is_active),
      cities_served_data:cities!cities_served(name, slug),
      subject_areas_data:subject_areas!subject_areas(name, slug, icon)
    `)
    .eq('filer_id', slug)
    .single();

  if (error) throw error;
  return data;
}
4.2.3 Claim Lobbyist Profile
typescriptexport async function claimLobbyist(filerID: string, userID: string) {
  // Check if already claimed
  const { data: existing } = await supabase
    .from('lobbyists')
    .select('claimed, user_id')
    .eq('filer_id', filerID)
    .single();

  if (existing?.claimed) {
    throw new Error('This profile has already been claimed');
  }

  // Update lobbyist record
  const { data, error } = await supabase
    .from('lobbyists')
    .update({
      user_id: userID,
      claimed: true,
      updated_at: new Date().toISOString()
    })
    .eq('filer_id', filerID)
    .select()
    .single();

  if (error) throw error;
  return data;
}
4.2.4 Update Lobbyist Profile
typescriptexport async function updateLobbyistProfile(
  lobbyistID: string,
  updates: Partial<Lobbyist>
) {
  const { data, error } = await supabase
    .from('lobbyists')
    .update({
      ...updates,
      updated_at: new Date().toISOString()
    })
    .eq('id', lobbyistID)
    .select()
    .single();

  if (error) throw error;
  return data;
}
4.2.5 Favorites
typescriptexport async function addFavorite(userID: string, lobbyistID: string) {
  const { data, error } = await supabase
    .from('favorites')
    .insert({ user_id: userID, lobbyist_id: lobbyistID })
    .select()
    .single();

  if (error) throw error;
  return data;
}

export async function removeFavorite(userID: string, lobbyistID: string) {
  const { error } = await supabase
    .from('favorites')
    .delete()
    .eq('user_id', userID)
    .eq('lobbyist_id', lobbyistID);

  if (error) throw error;
}

export async function getUserFavorites(userID: string) {
  const { data, error } = await supabase
    .from('favorites')
    .select(`
      lobbyist:lobbyists(*)
    `)
    .eq('user_id', userID);

  if (error) throw error;
  return data;
}
4.2.6 Track Page Views
typescriptexport async function trackPageView(
  lobbyistID: string,
  viewerType: 'anonymous' | 'authenticated',
  referrer?: string
) {
  const { error } = await supabase
    .from('page_views')
    .insert({
      lobbyist_id: lobbyistID,
      viewer_type: viewerType,
      referrer: referrer || null
    });

  if (error) throw error;
}
4.2.7 Get Analytics (Featured Lobbyists Only)
typescriptexport async function getLobbyistAnalytics(lobbyistID: string, days: number = 30) {
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - days);

  const { data, error } = await supabase
    .from('page_views')
    .select('created_at, viewer_type, referrer')
    .eq('lobbyist_id', lobbyistID)
    .gte('created_at', startDate.toISOString())
    .order('created_at', { ascending: false });

  if (error) throw error;

  // Process data for charts
  const viewsByDay = /* group by day */;
  const viewsByType = /* group by viewer_type */;
  const topReferrers = /* group by referrer */;

  return {
    totalViews: data.length,
    viewsByDay,
    viewsByType,
    topReferrers
  };
}
4.3 STRIPE INTEGRATION
Webhook Handler
typescript// src/pages/api/stripe-webhook.ts
import type { APIRoute } from 'astro';
import Stripe from 'stripe';
import { supabase } from '@/lib/supabase';

const stripe = new Stripe(import.meta.env.STRIPE_SECRET_KEY, {
  apiVersion: '2023-10-16'
});

export const POST: APIRoute = async ({ request }) => {
  const signature = request.headers.get('stripe-signature');
  const body = await request.text();

  let event: Stripe.Event;

  try {
    event = stripe.webhooks.constructEvent(
      body,
      signature!,
      import.meta.env.STRIPE_WEBHOOK_SECRET
    );
  } catch (err) {
    return new Response('Webhook signature verification failed', { status: 400 });
  }

  switch (event.type) {
    case 'checkout.session.completed': {
      const session = event.data.object as Stripe.Checkout.Session;
      
      // Update lobbyist with subscription info
      await supabase
        .from('lobbyists')
        .update({
          stripe_customer_id: session.customer as string,
          stripe_subscription_id: session.subscription as string,
          listing_tier: session.metadata?.tier || 'premium'
        })
        .eq('id', session.metadata?.lobbyist_id);
      break;
    }

    case 'customer.subscription.updated': {
      const subscription = event.data.object as Stripe.Subscription;
      
      // Handle subscription updates (tier changes, cancellations)
      const newTier = subscription.items.data[0].price.metadata?.tier || 'free';
      
      await supabase
        .from('lobbyists')
        .update({
          listing_tier: subscription.status === 'active' ? newTier : 'free'
        })
        .eq('stripe_subscription_id', subscription.id);
      break;
    }

    case 'customer.subscription.deleted': {
      const subscription = event.data.object as Stripe.Subscription;
      
      // Downgrade to free tier
      await supabase
        .from('lobbyists')
        .update({
          listing_tier: 'free',
          stripe_subscription_id: null
        })
        .eq('stripe_subscription_id', subscription.id);
      break;
    }
  }

  return new Response(JSON.stringify({ received: true }), { status: 200 });
};
Create Checkout Session
typescript// src/lib/stripe.ts
import Stripe from 'stripe';

const stripe = new Stripe(import.meta.env.STRIPE_SECRET_KEY);

export async function createCheckoutSession(
  lobbyistID: string,
  tier: 'premium' | 'featured' | 'sponsored',
  successUrl: string,
  cancelUrl: string
) {
  const prices = {
    premium: import.meta.env.STRIPE_PRICE_PREMIUM,
    featured: import.meta.env.STRIPE_PRICE_FEATURED,
    sponsored: import.meta.env.STRIPE_PRICE_SPONSORED
  };

  const session = await stripe.checkout.sessions.create({
    mode: 'subscription',
    line_items: [
      {
        price: prices[tier],
        quantity: 1
      }
    ],
    success_url: successUrl,
    cancel_url: cancelUrl,
    metadata: {
      lobbyist_id: lobbyistID,
      tier: tier
    }
  });

  return session;
}

5. UI/UX DESIGN SYSTEM
5.1 BRAND IDENTITY
Color Palette
css/* tailwind.config.mjs */
module.exports = {
  theme: {
    extend: {
      colors: {
        // Primary - Texas Blue
        primary: {
          50: '#e6f0ff',
          100: '#cce1ff',
          200: '#99c3ff',
          300: '#66a5ff',
          400: '#3387ff',
          500: '#003f87', // Main brand color
          600: '#003270',
          700: '#002659',
          800: '#001942',
          900: '#000d2b',
        },
        // Secondary - Lone Star Red
        secondary: {
          50: '#ffe6e6',
          100: '#ffcccc',
          200: '#ff9999',
          300: '#ff6666',
          400: '#ff3333',
          500: '#bf0a30', // Main brand color
          600: '#990826',
          700: '#73061d',
          800: '#4c0413',
          900: '#26020a',
        },
        // Accent - Austin Sage
        accent: {
          50: '#f5f6f4',
          100: '#ebeee9',
          200: '#d7dcd3',
          300: '#c3cbbd',
          400: '#afb9a7',
          500: '#8b9474', // Main brand color
          600: '#6f765d',
          700: '#535946',
          800: '#383b2f',
          900: '#1c1e18',
        },
      },
    },
  },
};
Typography
css/* src/styles/global.css */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

:root {
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
}

/* Headings */
h1, .h1 {
  @apply text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 tracking-tight;
}

h2, .h2 {
  @apply text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 tracking-tight;
}

h3, .h3 {
  @apply text-2xl md:text-3xl font-semibold text-gray-900;
}

h4, .h4 {
  @apply text-xl md:text-2xl font-semibold text-gray-900;
}

/* Body text */
.body-lg {
  @apply text-lg md:text-xl text-gray-700 leading-relaxed;
}

.body {
  @apply text-base text-gray-700 leading-relaxed;
}

.body-sm {
  @apply text-sm text-gray-600 leading-relaxed;
}
5.2 COMPONENT LIBRARY (shadcn/ui)
Required Components
Install these shadcn/ui components:
bashnpx shadcn-ui@latest add button
npx shadcn-ui@latest add card
npx shadcn-ui@latest add input
npx shadcn-ui@latest add label
npx shadcn-ui@latest add select
npx shadcn-ui@latest add checkbox
npx shadcn-ui@latest add badge
npx shadcn-ui@latest add avatar
npx shadcn-ui@latest add dropdown-menu
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add tabs
npx shadcn-ui@latest add separator
npx shadcn-ui@latest add skeleton
npx shadcn-ui@latest add toast
npx shadcn-ui@latest add form
Custom Components
5.2.1 SearchFilter Component
tsx// src/components/react/SearchFilter.tsx
import { useState } from 'react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';
import { Search, MapPin, Briefcase, Filter } from 'lucide-react';

interface SearchFilterProps {
  cities: Array<{ id: number; name: string }>;
  subjectAreas: Array<{ id: number; name: string; icon: string }>;
  onSearch: (filters: SearchFilters) => void;
}

export default function SearchFilter({ cities, subjectAreas, onSearch }: SearchFilterProps) {
  const [query, setQuery] = useState('');
  const [selectedCities, setSelectedCities] = useState<number[]>([]);
  const [selectedSubjects, setSelectedSubjects] = useState<number[]>([]);
  const [showFilters, setShowFilters] = useState(false);

  const handleSearch = () => {
    onSearch({
      query,
      cityIds: selectedCities,
      subjectAreaIds: selectedSubjects
    });
  };

  return (
    <div className="space-y-6">
      {/* Search Bar */}
      <div className="relative">
        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
        <Input
          type="text"
          placeholder="Search by name, specialty, or keyword..."
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
          className="pl-12 pr-4 py-6 text-lg"
        />
        <Button
          onClick={() => setShowFilters(!showFilters)}
          variant="outline"
          className="absolute right-2 top-1/2 -translate-y-1/2"
        >
          <Filter className="h-4 w-4 mr-2" />
          Filters
        </Button>
      </div>

      {/* Filters */}
      {showFilters && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-gray-50 rounded-lg">
          {/* Cities */}
          <div>
            <div className="flex items-center gap-2 mb-4">
              <MapPin className="h-5 w-5 text-primary-500" />
              <Label className="text-lg font-semibold">Cities</Label>
            </div>
            <div className="space-y-3 max-h-64 overflow-y-auto">
              {cities.map((city) => (
                <div key={city.id} className="flex items-center gap-2">
                  <Checkbox
                    id={`city-${city.id}`}
                    checked={selectedCities.includes(city.id)}
                    onCheckedChange={(checked) => {
                      if (checked) {
                        setSelectedCities([...selectedCities, city.id]);
                      } else {
                        setSelectedCities(selectedCities.filter(id => id !== city.id));
                      }
                    }}
                  />
                  <Label htmlFor={`city-${city.id}`} className="cursor-pointer">
                    {city.name}
                  </Label>
                </div>
              ))}
            </div>
          </div>

          {/* Subject Areas */}
          <div>
            <div className="flex items-center gap-2 mb-4">
              <Briefcase className="h-5 w-5 text-primary-500" />
              <Label className="text-lg font-semibold">Subject Areas</Label>
            </div>
            <div className="space-y-3 max-h-64 overflow-y-auto">
              {subjectAreas.map((subject) => (
                <div key={subject.id} className="flex items-center gap-2">
                  <Checkbox
                    id={`subject-${subject.id}`}
                    checked={selectedSubjects.includes(subject.id)}
                    onCheckedChange={(checked) => {
                      if (checked) {
                        setSelectedSubjects([...selectedSubjects, subject.id]);
                      } else {
                        setSelectedSubjects(selectedSubjects.filter(id => id !== subject.id));
                      }
                    }}
                  />
                  <Label htmlFor={`subject-${subject.id}`} className="cursor-pointer">
                    {subject.name}
                  </Label>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Search Button */}
      <Button onClick={handleSearch} size="lg" className="w-full md:w-auto">
        <Search className="h-5 w-5 mr-2" />
        Search Lobbyists
      </Button>
    </div>
  );
}
5.2.2 LobbyistCard Component
tsx// src/components/react/LobbyistCard.tsx
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { MapPin, Briefcase, Users, Star } from 'lucide-react';

interface LobbyistCardProps {
  lobbyist: {
    id: string;
    name: string;
    business_type: string;
    profile_image_url?: string;
    office_city: { name: string };
    subject_areas_data: Array<{ name: string }>;
    clients: Array<{ name: string }>;
    listing_tier: 'free' | 'premium' | 'featured';
  };
}

export default function LobbyistCard({ lobbyist }: LobbyistCardProps) {
  const initials = lobbyist.name
    .split(' ')
    .map(n => n[0])
    .join('')
    .toUpperCase();

  return (
    <Card className={`hover:shadow-lg transition-shadow ${
      lobbyist.listing_tier === 'featured' ? 'border-2 border-primary-500' : ''
    }`}>
      {lobbyist.listing_tier === 'featured' && (
        <div className="bg-primary-500 text-white px-4 py-2 flex items-center gap-2">
          <Star className="h-4 w-4 fill-current" />
          <span className="text-sm font-semibold">Featured Lobbyist</span>
        </div>
      )}
      
      <CardHeader>
        <div className="flex items-start gap-4">
          <Avatar className="h-16 w-16">
            <AvatarImage src={lobbyist.profile_image_url} alt={lobbyist.name} />
            <AvatarFallback>{initials}</AvatarFallback>
          </Avatar>
          
          <div className="flex-1">
            <CardTitle className="text-xl mb-1">
              <a href={`/lobbyists/${lobbyist.id}`} className="hover:text-primary-500">
                {lobbyist.name}
              </a>
            </CardTitle>
            <CardDescription className="flex items-center gap-2">
              <Briefcase className="h-4 w-4" />
              {lobbyist.business_type}
            </CardDescription>
            <CardDescription className="flex items-center gap-2 mt-1">
              <MapPin className="h-4 w-4" />
              {lobbyist.office_city.name}, TX
            </CardDescription>
          </div>
        </div>
      </CardHeader>

      <CardContent>
        {/* Subject Areas */}
        <div className="mb-4">
          <p className="text-sm font-semibold text-gray-700 mb-2">Specializes In:</p>
          <div className="flex flex-wrap gap-2">
            {lobbyist.subject_areas_data.slice(0, 3).map((subject, idx) => (
              <Badge key={idx} variant="secondary">{subject.name}</Badge>
            ))}
            {lobbyist.subject_areas_data.length > 3 && (
              <Badge variant="outline">+{lobbyist.subject_areas_data.length - 3} more</Badge>
            )}
          </div>
        </div>

        {/* Active Clients */}
        <div className="flex items-center gap-2 text-sm text-gray-600">
          <Users className="h-4 w-4" />
          <span>{lobbyist.clients.length} active clients</span>
        </div>
      </CardContent>
    </Card>
  );
}
5.3 PAGE LAYOUTS
5.3.1 Homepage Layout
astro---
// src/pages/index.astro
import Layout from '@/components/astro/Layout.astro';
import SearchFilter from '@/components/react/SearchFilter';
import { supabase } from '@/lib/supabase';

const { data: cities } = await supabase.from('cities').select('id, name').order('name');
const { data: subjectAreas } = await supabase.from('subject_areas').select('id, name, icon').order('name');
const { data: featuredLobbyists } = await supabase
  .from('lobbyists')
  .select('*, office_city:cities(name), subject_areas_data:subject_areas!subject_areas(name), clients(name)')
  .eq('listing_tier', 'featured')
  .eq('claimed', true)
  .limit(6);
---

<Layout title="Find Your Voice in Texas Politics | TexasLobby.org">
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-primary-500 to-primary-700 text-white py-20">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6">
          Find Your Voice in Texas Politics
        </h1>
        <p class="text-xl md:text-2xl mb-8 text-primary-100">
          Connect with experienced lobbyists who fight for your interests in Austin
        </p>
        
        <!-- Search Component -->
        <div class="bg-white rounded-lg shadow-2xl p-6">
          <SearchFilter 
            cities={cities}
            subjectAreas={subjectAreas}
            client:load
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Problem/Solution Section (StoryBrand) -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold mb-6">
          Legislation Passes That Hurts Your Business. You Had No Voice.
        </h2>
        <p class="text-xl text-gray-700 mb-8">
          The Texas political system shouldn't feel rigged against you. Whether you're a business owner, nonprofit leader, or concerned citizen, you deserve a seat at the table when laws are made that affect your livelihood.
        </p>
        <div class="grid md:grid-cols-3 gap-8 mt-12">
          <div class="text-center">
            <div class="bg-primary-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <span class="text-3xl font-bold text-primary-500">1</span>
            </div>
            <h3 class="font-semibold mb-2">Search by Your Needs</h3>
            <p class="text-gray-600">Filter by industry, location, and expertise</p>
          </div>
          <div class="text-center">
            <div class="bg-primary-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <span class="text-3xl font-bold text-primary-500">2</span>
            </div>
            <h3 class="font-semibold mb-2">See Their Track Record</h3>
            <p class="text-gray-600">Review clients, wins, and conflicts</p>
          </div>
          <div class="text-center">
            <div class="bg-primary-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
              <span class="text-3xl font-bold text-primary-500">3</span>
            </div>
            <h3 class="font-semibold mb-2">Get Represented</h3>
            <p class="text-gray-600">Connect directly and claim your voice</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Lobbyists -->
  <section class="py-16">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12">Featured Lobbyists</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {featuredLobbyists?.map(lobbyist => (
          <LobbyistCard lobbyist={lobbyist} />
        ))}
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="py-16 bg-primary-500 text-white">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-6">
        If You Need Legislative Influence in Texas, Hiring a Lobbyist Is the Right Decision
      </h2>
      <p class="text-xl mb-8 text-primary-100">
        Don't let another legislative session pass without representation.
      </p>
      <a href="/lobbyists" class="inline-block bg-white text-primary-500 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-100 transition">
        Find Your Lobbyist Now
      </a>
    </div>
  </section>
</Layout>
5.3.2 Lobbyist Profile Layout
astro---
// src/pages/lobbyists/[slug].astro
import Layout from '@/components/astro/Layout.astro';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';

const { slug } = Astro.params;
const lobbyist = await getLobbyistBySlug(slug);
---

<Layout title={`${lobbyist.name} - Texas Lobbyist | TexasLobby.org`}>
  <div class="container mx-auto px-4 py-12">
    <!-- Profile Header -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <div class="flex flex-col md:flex-row gap-8">
        <!-- Avatar -->
        <div class="flex-shrink-0">
          <Avatar className="h-32 w-32">
            <AvatarImage src={lobbyist.profile_image_url} />
            <AvatarFallback>{initials}</AvatarFallback>
          </Avatar>
        </div>

        <!-- Info -->
        <div class="flex-1">
          <div class="flex items-start justify-between">
            <div>
              <h1 class="text-4xl font-bold mb-2">{lobbyist.name}</h1>
              <p class="text-xl text-gray-600 mb-4">{lobbyist.business_type}</p>
              <div class="flex flex-wrap gap-2 mb-4">
                {lobbyist.subject_areas_data.map(subject => (
                  <Badge variant="secondary">{subject.name}</Badge>
                ))}
              </div>
            </div>
            {lobbyist.listing_tier === 'featured' && (
              <Badge className="bg-primary-500">Featured</Badge>
            )}
          </div>

          <!-- Contact -->
          <div class="flex flex-wrap gap-6 text-gray-700">
            {lobbyist.email && (
              <a href={`mailto:${lobbyist.email}`} class="flex items-center gap-2 hover:text-primary-500">
                <Mail className="h-5 w-5" />
                {lobbyist.email}
              </a>
            )}
            {lobbyist.phone && (
              <a href={`tel:${lobbyist.phone}`} class="flex items-center gap-2 hover:text-primary-500">
                <Phone className="h-5 w-5" />
                {lobbyist.phone}
              </a>
            )}
            {lobbyist.website && (
              <a href={lobbyist.website} target="_blank" class="flex items-center gap-2 hover:text-primary-500">
                <Globe className="h-5 w-5" />
                Website
              </a>
            )}
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <Tabs defaultValue="about" className="space-y-8">
      <TabsList>
        <TabsTrigger value="about">About</TabsTrigger>
        <TabsTrigger value="clients">Clients</TabsTrigger>
        <TabsTrigger value="contact">Contact</TabsTrigger>
      </TabsList>

      <TabsContent value="about">
        <div class="bg-white rounded-lg shadow p-8">
          <h2 class="text-2xl font-bold mb-4">About</h2>
          <div class="prose max-w-none">
            {lobbyist.bio || 'No biography provided.'}
          </div>
        </div>
      </TabsContent>

      <TabsContent value="clients">
        <div class="bg-white rounded-lg shadow p-8">
          <h2 class="text-2xl font-bold mb-4">Current Clients</h2>
          <div class="grid md:grid-cols-2 gap-4">
            {lobbyist.clients.filter(c => c.is_active).map(client => (
              <div class="border rounded p-4">
                <p class="font-semibold">{client.name}</p>
                <p class="text-sm text-gray-600">
                  {client.start_date} - {client.end_date || 'Present'}
                </p>
              </div>
            ))}
          </div>
        </div>
      </TabsContent>

      <TabsContent value="contact">
        <div class="bg-white rounded-lg shadow p-8">
          <h2 class="text-2xl font-bold mb-4">Get In Touch</h2>
          <p class="text-lg mb-6">
            If you need legislative influence in Texas, reaching out to {lobbyist.name} is the right decision.
          </p>
          <div class="space-y-4">
            {lobbyist.email && (
              <Button asChild size="lg" className="w-full md:w-auto">
                <a href={`mailto:${lobbyist.email}`}>
                  <Mail className="mr-2 h-5 w-5" />
                  Send Email
                </a>
              </Button>
            )}
            {lobbyist.phone && (
              <Button asChild variant="outline" size="lg" className="w-full md:w-auto">
                <a href={`tel:${lobbyist.phone}`}>
                  <Phone className="mr-2 h-5 w-5" />
                  Call Now
                </a>
              </Button>
            )}
          </div>
        </div>
      </TabsContent>
    </Tabs>
  </div>
</Layout>

6. USER STORIES & ACCEPTANCE CRITERIA
6.1 BUSINESS OWNER (SEARCHER) STORIES
Story 1: Search for Lobbyists
As a business owner
I want to search for lobbyists by location and specialty
So that I can find someone who understands my industry
Acceptance Criteria:

 Search bar accepts text input
 Can filter by multiple cities simultaneously
 Can filter by multiple subject areas simultaneously
 Results update in real-time as filters are applied
 Featured lobbyists appear at top of results
 Results show name, location, specialties, and client count
 Can click result to view full profile
 Search works on mobile devices
 No results state shows helpful message

Story 2: View Lobbyist Profile
As a business owner
I want to view detailed information about a lobbyist
So that I can decide if they're the right fit for my needs
Acceptance Criteria:

 Profile shows name, photo, bio, business type
 Shows all subject areas they work in
 Shows current and past clients (if disclosed)
 Shows contact information (email, phone, website)
 Shows office location
 Featured badge displays for featured lobbyists
 Can favorite the lobbyist (if logged in)
 Page loads in under 2 seconds
 Schema.org markup present for SEO

Story 3: Save Favorites
As a business owner
I want to save my favorite lobbyists
So that I can compare them later
Acceptance Criteria:

 Heart icon to favorite/unfavorite on profile
 Requires login to favorite
 Favorites persist across sessions
 Can view all favorites in dashboard
 Can remove favorites from dashboard
 Favoriting is instant (no page reload)

Story 4: Compare Lobbyists
As a business owner
I want to compare multiple lobbyists side-by-side
So that I can make an informed decision
Acceptance Criteria:

 Can select up to 3 lobbyists to compare
 Comparison shows: name, specialties, clients, pricing tier
 Table format on desktop, cards on mobile
 Can print or export comparison
 Can contact lobbyists directly from comparison view

Story 5: Download Educational Guide
As a business owner
I want to download a guide about hiring lobbyists
So that I can understand the process
Acceptance Criteria:

 Lead magnet form requires name and email
 PDF downloads immediately after submission
 Email added to mailing list
 Confirmation email sent with download link
 Form validates input before submission

6.2 LOBBYIST (LISTING OWNER) STORIES
Story 6: Claim Profile
As a lobbyist
I want to claim my profile created from public data
So that I can manage my listing
Acceptance Criteria:

 Can search for profile by name or Filer ID
 Verification required (email confirmation)
 Cannot claim already-claimed profiles
 Claiming creates user account automatically
 Redirects to profile edit after claiming
 Email sent confirming claim

Story 7: Edit Profile
As a lobbyist
I want to edit my profile information
So that potential clients see accurate details
Acceptance Criteria:

 Can edit: bio, contact info, website, LinkedIn
 Can upload profile photo (max 2MB, square crop)
 Can add/remove cities served
 Can add/remove subject areas
 Cannot edit: name, Filer ID, public record data
 Changes save instantly
 Success message shows after save
 Invalid inputs show error messages

Story 8: Upgrade to Premium
As a lobbyist
I want to upgrade my listing to premium
So that I get more visibility
Acceptance Criteria:

 Pricing page clearly shows tier differences
 Stripe Checkout flow for payment
 Subscription activates immediately after payment
 Profile updated with "Premium" badge
 Receipt email sent
 Can manage subscription from dashboard
 Can cancel anytime

Story 9: View Analytics
As a featured lobbyist
I want to view analytics on my profile views
So that I can measure ROI
Acceptance Criteria:

 Dashboard shows total views (30 days)
 Chart showing views by day
 Shows top referrers (where views came from)
 Shows anonymous vs authenticated viewers
 Updates daily
 Can export data as CSV
 Only available to Featured tier

6.3 ADMIN STORIES
Story 10: Manage Content
As an admin
I want to create and edit guides/blog posts
So that we can educate users
Acceptance Criteria:

 Can create new content via admin panel
 Markdown editor with preview
 Can add meta title, description, slug
 Can publish or save as draft
 Published content appears on site immediately
 Can edit existing content
 Can delete content (with confirmation)


7. SEO & CONTENT REQUIREMENTS
7.1 ON-PAGE SEO CHECKLIST
Every Page Must Have:

 Unique <title> tag (55-60 characters)
 Unique meta description (155-160 characters)
 H1 tag (one per page, contains primary keyword)
 H2-H6 tags (hierarchical structure)
 Open Graph tags for social sharing
 Twitter Card tags
 Canonical URL
 Schema.org structured data
 Alt text on all images
 Internal links to related pages
 Mobile-responsive
 HTTPS
 Fast loading (< 3s)

Meta Tag Templates
html<!-- Homepage -->
<title>Find Texas Lobbyists by City & Specialty | TexasLobby.org</title>
<meta name="description" content="Connect with experienced Texas lobbyists. Search by city, industry, and expertise. Transparent profiles with client lists and track records. Find your voice in Austin.">

<!-- City Page -->
<title>Houston Lobbyists | Find Legislative Advocates in Houston, TX</title>
<meta name="description" content="Connect with {count} experienced lobbyists in Houston, TX. Compare specialties, clients, and track records. Find the right advocate for your business.">

<!-- Subject Page -->
<title>Healthcare Lobbyists in Texas | Medical Policy Advocates</title>
<meta name="description" content="Find Texas lobbyists specializing in healthcare policy, insurance, hospitals, and medical legislation. Compare {count} healthcare advocates.">

<!-- Lobbyist Profile -->
<title>{Name} - {Business Type} Lobbyist in {City} | TexasLobby.org</title>
<meta name="description" content="{Name} is a {business_type} lobbyist in {city} specializing in {subject_areas}. View client list, expertise, and contact information.">

<!-- Guide -->
<title>{Guide Title} | TexasLobby.org</title>
<meta name="description" content="{Excerpt of guide content, 155-160 characters}">
7.2 SCHEMA.ORG MARKUP
Homepage Schema
json{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "TexasLobby.org",
  "url": "https://texaslobby.org",
  "description": "Find experienced Texas lobbyists by city and specialty",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://texaslobby.org/lobbyists?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
Lobbyist Profile Schema
json{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{lobbyist.name}",
  "jobTitle": "{lobbyist.business_type}",
  "description": "{lobbyist.bio}",
  "image": "{lobbyist.profile_image_url}",
  "email": "{lobbyist.email}",
  "telephone": "{lobbyist.phone}",
  "url": "{lobbyist.website}",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "{lobbyist.office_city}",
    "addressRegion": "TX",
    "postalCode": "{lobbyist.office_zip}",
    "addressCountry": "US"
  },
  "knowsAbout": [
    "{subject_area_1}",
    "{subject_area_2}"
  ],
  "alumniOf": {
    "@type": "Organization",
    "name": "Texas Lobbyist"
  }
}
City Page Schema (ItemList)
json{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Houston Lobbyists",
  "description": "Experienced lobbyists serving Houston, Texas",
  "numberOfItems": {count},
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@type": "Person",
        "name": "{lobbyist.name}",
        "url": "https://texaslobby.org/lobbyists/{slug}"
      }
    }
  ]
}
Guide/Article Schema
json{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{guide.title}",
  "description": "{guide.excerpt}",
  "image": "{guide.featured_image}",
  "author": {
    "@type": "Organization",
    "name": "TexasLobby.org"
  },
  "publisher": {
    "@type": "Organization",
    "name": "TexasLobby.org",
    "logo": {
      "@type": "ImageObject",
      "url": "https://texaslobby.org/logo.png"
    }
  },
  "datePublished": "{guide.created_at}",
  "dateModified": "{guide.updated_at}"
}
```

## 7.3 CONTENT STRATEGY

### Phase 1: Foundation (Launch)

**City Pages (5 major metros):**
1. Houston Lobbyists
2. Dallas Lobbyists
3. Austin Lobbyists
4. San Antonio Lobbyists
5. Fort Worth Lobbyists

**Template Structure:**
```
H1: {City} Lobbyists | Find Legislative Advocates in {City}, TX

Intro (200 words):
- Why businesses in {City} need lobbyists
- Key industries in {City}
- Local legislative issues

H2: Top Lobbyists Serving {City}
[Lobbyist cards with filtering]

H2: Why Hire a Lobbyist in {City}?
- Bullet points of specific local issues
- Examples of legislation affecting {City} businesses

H2: Industries We Serve in {City}
- Links to subject area pages

H2: How to Choose a {City} Lobbyist
- Checklist of what to look for

CTA: If you're struggling with legislative issues in {City}, hiring a lobbyist is the right decision.
```

**Subject Area Pages (10 core industries):**
1. Healthcare Lobbyists in Texas
2. Energy Lobbyists in Texas
3. Education Lobbyists in Texas
4. Real Estate Lobbyists in Texas
5. Transportation Lobbyists in Texas
6. Technology Lobbyists in Texas
7. Agriculture Lobbyists in Texas
8. Business & Commerce Lobbyists in Texas
9. Insurance Lobbyists in Texas
10. Legal & Judicial Lobbyists in Texas

**Template Structure:**
```
H1: {Subject} Lobbyists in Texas

Intro (200 words):
- Overview of {subject} lobbying in Texas
- Key legislative issues
- Why {subject} needs representation

H2: Find {Subject} Lobbyists
[Filtered lobbyist cards]

H2: Key Issues in Texas {Subject} Policy
- Bullet points of current hot topics
- Recent legislation

H2: What a {Subject} Lobbyist Does
- Specific responsibilities
- Example outcomes

H2: How to Hire a {Subject} Lobbyist
- Questions to ask
- Red flags to avoid

CTA: If your {subject} business needs legislative advocacy, finding the right lobbyist is the right decision.
```

**Educational Guides (5 core pieces):**

1. **"How Lobbying Works in Texas"** (Comprehensive, 3000+ words)
   - What is lobbying?
   - Texas lobbying laws and ethics
   - How a bill becomes a law in Texas
   - How lobbyists influence legislation
   - Common misconceptions
   - FAQs

2. **"How to Hire a Texas Lobbyist"** (Lead magnet PDF, 2000 words)
   - When you need a lobbyist
   - Questions to ask before hiring
   - Red flags to watch for
   - Cost expectations
   - Contracts and agreements
   - Measuring success

3. **"What Does a Lobbyist Cost in Texas?"** (1500 words)
   - Fee structures (retainer, hourly, contingency)
   - Average costs by industry
   - What's included
   - Hidden costs
   - ROI calculations
   - Budget planning

4. **"Texas Lobbying Laws & Ethics"** (2000 words)
   - Legal requirements for lobbyists
   - Registration and reporting
   - Gift rules and restrictions
   - Disclosure requirements
   - Ethics commission oversight
   - Penalties for violations

5. **"5 Signs Your Business Needs a Lobbyist"** (1200 words)
   - Pending legislation affects you
   - Industry under regulatory threat
   - Competitors are lobbying
   - Need favorable legislation
   - Government contracts
   - Case studies

### Phase 2: Expansion (Month 4-6)

**Additional City Pages (15-20 mid-size cities):**
- El Paso, Arlington, Corpus Christi, Plano, Laredo, Lubbock, Garland, Irving, Amarillo, Grand Prairie, Brownsville, McKinney, Frisco, Pasadena, Mesquite, Killeen, McAllen, Waco, Carrollton, Denton

**Additional Subject Area Pages (10 more niches):**
- Environmental Policy
- Gaming & Gambling
- Alcohol & Beverage
- Financial Services
- Cannabis (Medical)
- Telecommunications
- Nonprofit & Advocacy
- Labor & Employment
- Criminal Justice Reform
- Veterans Affairs

**Blog Content (2 posts per week):**
- Legislative session updates
- Analysis of recent bills
- Lobbyist spotlights
- Case studies
- Industry trends
- How-to articles

**Example Blog Titles:**
- "What the 2025 Texas Legislative Session Means for Healthcare"
- "How One Houston Restaurant Saved $50K with Lobbying"
- "Breaking Down HB 1234: What Energy Companies Need to Know"
- "Meet Jane Smith: The Lobbyist Fighting for Texas Teachers"
- "5 Mistakes Businesses Make When Hiring a Lobbyist"

### Phase 3: Domination (Month 7-18)

**Long-Tail City/Subject Combinations:**
- "Healthcare Lobbyists in Houston"
- "Energy Lobbyists in Dallas"
- "Real Estate Lobbyists in Austin"
(Create pages for high-value combinations)

**Advanced Guides:**
- "Complete Guide to Texas Legislative Sessions"
- "Lobbying for Nonprofits: A Step-by-Step Guide"
- "How to Track Your Lobbyist's Progress"
- "Understanding Texas Political Action Committees (PACs)"
- "Grassroots vs. Professional Lobbying in Texas"

**Interactive Tools:**
- Bill tracker (track legislation by subject area)
- Lobbyist comparison calculator
- ROI estimator ("How much could lobbying save you?")
- Quiz: "Do You Need a Lobbyist?"

## 7.4 INTERNAL LINKING STRATEGY

**Hub & Spoke Model:**
```
Homepage (Hub)
├── Cities Hub Page
│   ├── Houston (spoke)
│   ├── Dallas (spoke)
│   └── Austin (spoke)
├── Subject Areas Hub Page
│   ├── Healthcare (spoke)
│   ├── Energy (spoke)
│   └── Education (spoke)
├── Guides Hub Page
│   ├── How Lobbying Works
│   ├── How to Hire
│   └── Cost Guide
└── Lobbyist Directory
    └── Individual Profiles
Linking Rules:

Every city page links to:

All subject area pages
3-5 lobbyists in that city
Relevant guides
Homepage


Every subject area page links to:

All city pages where that subject has lobbyists
5-10 lobbyists in that specialty
Relevant guides
Homepage


Every lobbyist profile links to:

Their office city page
Their subject area pages
Comparison tool
Relevant guides


Every guide links to:

5-10 relevant lobbyist profiles
Relevant city/subject pages
Other guides
Homepage



7.5 KEYWORD TARGETING
Primary Keywords (Homepage):

texas lobbyists (720/mo, Difficulty: 35)
lobbyist texas (590/mo, Difficulty: 32)
texas lobbyist directory (210/mo, Difficulty: 28)

City Keywords (Per City Page):

[city] lobbyists (avg 150/mo per major city)
lobbyist in [city] texas (avg 80/mo)
[city] lobbying services (avg 40/mo)
hire lobbyist [city] (avg 30/mo)

Subject Keywords (Per Subject Page):

[subject] lobbyist texas (avg 100/mo per subject)
texas [subject] lobbying (avg 60/mo)
hire [subject] lobbyist (avg 40/mo)

Informational Keywords (Guides):

how does lobbying work in texas (320/mo)
how to hire a lobbyist (480/mo)
what does a lobbyist cost (290/mo)
lobbying laws texas (180/mo)
do i need a lobbyist (150/mo)

Long-Tail Keywords (Blog/Niche Pages):

healthcare lobbyist houston (40/mo)
energy lobbyist dallas (30/mo)
how much does lobbying cost in texas (50/mo)
texas ethics commission lobbying (110/mo)


8. INTEGRATION REQUIREMENTS
8.1 STRIPE INTEGRATION
Products & Prices Setup
In Stripe Dashboard, create:

Premium Listing

Product Name: "Premium Listing"
Description: "Enhanced profile with priority placement in search results"
Price: $297/month (recurring)
Metadata: tier: premium


Featured Listing

Product Name: "Featured Listing"
Description: "Homepage placement, top of search results, analytics dashboard"
Price: $597/month (recurring)
Metadata: tier: featured


Sponsored Category

Product Name: "Sponsored Category"
Description: "Own the top spot for specific keyword/category searches"
Price: $997/month (recurring)
Metadata: tier: sponsored



Checkout Flow
typescript// src/pages/api/create-checkout-session.ts
import type { APIRoute } from 'astro';
import Stripe from 'stripe';
import { supabase } from '@/lib/supabase';

const stripe = new Stripe(import.meta.env.STRIPE_SECRET_KEY);

export const POST: APIRoute = async ({ request }) => {
  const { lobbyistId, tier } = await request.json();

  // Verify user owns this lobbyist profile
  const session = await getSession(request);
  const { data: lobbyist } = await supabase
    .from('lobbyists')
    .select('user_id')
    .eq('id', lobbyistId)
    .single();

  if (lobbyist?.user_id !== session?.user?.id) {
    return new Response('Unauthorized', { status: 403 });
  }

  // Get price ID based on tier
  const priceIds = {
    premium: import.meta.env.STRIPE_PRICE_PREMIUM,
    featured: import.meta.env.STRIPE_PRICE_FEATURED,
    sponsored: import.meta.env.STRIPE_PRICE_SPONSORED
  };

  // Create checkout session
  const checkoutSession = await stripe.checkout.sessions.create({
    mode: 'subscription',
    line_items: [
      {
        price: priceIds[tier],
        quantity: 1
      }
    ],
    success_url: `${import.meta.env.PUBLIC_SITE_URL}/dashboard?success=true`,
    cancel_url: `${import.meta.env.PUBLIC_SITE_URL}/pricing?canceled=true`,
    client_reference_id: lobbyistId,
    metadata: {
      lobbyist_id: lobbyistId,
      tier: tier
    }
  });

  return new Response(JSON.stringify({ url: checkoutSession.url }), {
    status: 200,
    headers: { 'Content-Type': 'application/json' }
  });
};
Customer Portal
typescript// src/pages/api/create-portal-session.ts
import type { APIRoute } from 'astro';
import Stripe from 'stripe';
import { supabase } from '@/lib/supabase';

const stripe = new Stripe(import.meta.env.STRIPE_SECRET_KEY);

export const POST: APIRoute = async ({ request }) => {
  const session = await getSession(request);
  
  // Get lobbyist's Stripe customer ID
  const { data: lobbyist } = await supabase
    .from('lobbyists')
    .select('stripe_customer_id')
    .eq('user_id', session?.user?.id)
    .single();

  if (!lobbyist?.stripe_customer_id) {
    return new Response('No subscription found', { status: 404 });
  }

  // Create portal session
  const portalSession = await stripe.billingPortal.sessions.create({
    customer: lobbyist.stripe_customer_id,
    return_url: `${import.meta.env.PUBLIC_SITE_URL}/dashboard`
  });

  return new Response(JSON.stringify({ url: portalSession.url }), {
    status: 200,
    headers: { 'Content-Type': 'application/json' }
  });
};
8.2 EMAIL INTEGRATION (RESEND)
Setup
typescript// src/lib/email.ts
import { Resend } from 'resend';

const resend = new Resend(import.meta.env.RESEND_API_KEY);

export async function sendEmail(params: {
  to: string;
  subject: string;
  html: string;
}) {
  return await resend.emails.send({
    from: 'TexasLobby <noreply@texaslobby.org>',
    to: params.to,
    subject: params.subject,
    html: params.html
  });
}
Email Templates
1. Welcome Email (After Signup)
typescriptexport async function sendWelcomeEmail(email: string, name: string) {
  const html = `
    <h1>Welcome to TexasLobby.org, ${name}!</h1>
    <p>Thank you for creating an account. You can now:</p>
    <ul>
      <li>Save favorite lobbyists</li>
      <li>Compare multiple lobbyists</li>
      <li>Track your searches</li>
    </ul>
    <p><a href="https://texaslobby.org/lobbyists">Start searching for lobbyists</a></p>
  `;

  return sendEmail({
    to: email,
    subject: 'Welcome to TexasLobby.org',
    html
  });
}
2. Profile Claimed Email (To Lobbyist)
typescriptexport async function sendProfileClaimedEmail(email: string, name: string, profileUrl: string) {
  const html = `
    <h1>You've Successfully Claimed Your Profile</h1>
    <p>Hi ${name},</p>
    <p>Your lobbyist profile on TexasLobby.org has been claimed and is now live.</p>
    <p><a href="${profileUrl}">View your profile</a></p>
    <p>Next steps:</p>
    <ul>
      <li>Add a professional bio</li>
      <li>Upload a profile photo</li>
      <li>Verify your contact information</li>
      <li>Consider upgrading to Premium for more visibility</li>
    </ul>
    <p><a href="https://texaslobby.org/dashboard">Go to your dashboard</a></p>
  `;

  return sendEmail({
    to: email,
    subject: 'Your TexasLobby.org Profile Is Live',
    html
  });
}
3. Lead Magnet Delivery
typescriptexport async function sendLeadMagnet(email: string, name: string) {
  const html = `
    <h1>Your Guide to Hiring a Texas Lobbyist</h1>
    <p>Hi ${name},</p>
    <p>Thank you for downloading our comprehensive guide!</p>
    <p><a href="https://texaslobby.org/downloads/how-to-hire-a-lobbyist.pdf">Download your guide (PDF)</a></p>
    <p>While you're here, you might also find these resources helpful:</p>
    <ul>
      <li><a href="https://texaslobby.org/guides/what-does-a-lobbyist-cost">What Does a Lobbyist Cost?</a></li>
      <li><a href="https://texaslobby.org/guides/how-lobbying-works">How Lobbying Works in Texas</a></li>
    </ul>
    <p>Ready to find your lobbyist? <a href="https://texaslobby.org/lobbyists">Start searching</a></p>
  `;

  return sendEmail({
    to: email,
    subject: 'Your Guide: How to Hire a Texas Lobbyist',
    html
  });
}
4. Subscription Confirmation
typescriptexport async function sendSubscriptionConfirmation(email: string, name: string, tier: string) {
  const tierBenefits = {
    premium: 'Enhanced profile, priority in search results',
    featured: 'Homepage placement, top of search results, analytics dashboard',
    sponsored: 'Exclusive top placement for your chosen categories'
  };

  const html = `
    <h1>Subscription Confirmed</h1>
    <p>Hi ${name},</p>
    <p>Your ${tier} listing subscription has been activated!</p>
    <p><strong>What's included:</strong></p>
    <p>${tierBenefits[tier]}</p>
    <p><a href="https://texaslobby.org/dashboard">Go to your dashboard</a></p>
    <p>Questions? Reply to this email and we'll help you out.</p>
  `;

  return sendEmail({
    to: email,
    subject: `Your ${tier} Listing Is Now Active`,
    html
  });
}
8.3 ANALYTICS INTEGRATION (PLAUSIBLE)
Setup
astro---
// src/components/astro/Analytics.astro
const PLAUSIBLE_DOMAIN = import.meta.env.PUBLIC_PLAUSIBLE_DOMAIN || 'texaslobby.org';
---

<script defer data-domain={PLAUSIBLE_DOMAIN} src="https://plausible.io/js/script.js"></script>

<!-- Custom events for tracking -->
<script>
  // Track search queries
  window.addEventListener('search', (e) => {
    plausible('Search', { props: { query: e.detail.query } });
  });

  // Track profile views
  window.addEventListener('profile-view', (e) => {
    plausible('Profile View', { props: { lobbyist_id: e.detail.id } });
  });

  // Track upgrades
  window.addEventListener('upgrade-click', (e) => {
    plausible('Upgrade Click', { props: { tier: e.detail.tier } });
  });

  // Track favorites
  window.addEventListener('favorite', (e) => {
    plausible('Favorite', { props: { lobbyist_id: e.detail.id } });
  });
</script>
Custom Events
typescript// src/lib/analytics.ts
export function trackSearch(query: string, filters: any) {
  window.dispatchEvent(new CustomEvent('search', {
    detail: { query, filters }
  }));
}

export function trackProfileView(lobbyistId: string) {
  window.dispatchEvent(new CustomEvent('profile-view', {
    detail: { id: lobbyistId }
  }));
}

export function trackUpgradeClick(tier: string) {
  window.dispatchEvent(new CustomEvent('upgrade-click', {
    detail: { tier }
  }));
  }
export function trackFavorite(lobbyistId: string) {
window.dispatchEvent(new CustomEvent('favorite', {
detail: { id: lobbyistId }
}));
}
export function trackLeadMagnetDownload(guide: string) {
window.dispatchEvent(new CustomEvent('lead-magnet', {
detail: { guide }
}));
}

## 8.4 GOOGLE SEARCH CONSOLE INTEGRATION

### Setup
```astro
---
// src/components/astro/SEO.astro
const GOOGLE_SITE_VERIFICATION = import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION;
---

<meta name="google-site-verification" content={GOOGLE_SITE_VERIFICATION} />
```

### Sitemap Generation
```typescript
// src/pages/sitemap.xml.ts
import type { APIRoute } from 'astro';
import { supabase } from '@/lib/supabase';

export const GET: APIRoute = async () => {
  const baseUrl = 'https://texaslobby.org';

  // Static pages
  const staticPages = [
    '',
    '/lobbyists',
    '/cities',
    '/subjects',
    '/guides',
    '/pricing',
    '/about',
    '/contact'
  ];

  // Get all lobbyists
  const { data: lobbyists } = await supabase
    .from('lobbyists')
    .select('filer_id, updated_at')
    .eq('claimed', true);

  // Get all cities
  const { data: cities } = await supabase
    .from('cities')
    .select('slug');

  // Get all subject areas
  const { data: subjects } = await supabase
    .from('subject_areas')
    .select('slug');

  // Build sitemap XML
  const sitemap = `<?xml version="1.0" encoding="UTF-8"?>
    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
      ${staticPages.map(page => `
        <url>
          <loc>${baseUrl}${page}</loc>
          <changefreq>weekly</changefreq>
          <priority>${page === '' ? '1.0' : '0.8'}</priority>
        </url>
      `).join('')}
      
      ${lobbyists?.map(lobbyist => `
        <url>
          <loc>${baseUrl}/lobbyists/${lobbyist.filer_id}</loc>
          <lastmod>${new Date(lobbyist.updated_at).toISOString()}</lastmod>
          <changefreq>monthly</changefreq>
          <priority>0.7</priority>
        </url>
      `).join('') || ''}
      
      ${cities?.map(city => `
        <url>
          <loc>${baseUrl}/cities/${city.slug}</loc>
          <changefreq>weekly</changefreq>
          <priority>0.9</priority>
        </url>
      `).join('') || ''}
      
      ${subjects?.map(subject => `
        <url>
          <loc>${baseUrl}/subjects/${subject.slug}</loc>
          <changefreq>weekly</changefreq>
          <priority>0.9</priority>
        </url>
      `).join('') || ''}
    </urlset>
  `;

  return new Response(sitemap, {
    headers: {
      'Content-Type': 'application/xml'
    }
  });
};
```

### Robots.txt
```typescript
// src/pages/robots.txt.ts
import type { APIRoute } from 'astro';

export const GET: APIRoute = () => {
  const robotsTxt = `
User-agent: *
Allow: /
Disallow: /dashboard
Disallow: /api/

Sitemap: https://texaslobby.org/sitemap.xml
  `.trim();

  return new Response(robotsTxt, {
    headers: {
      'Content-Type': 'text/plain'
    }
  });
};
```

---

# 9. SECURITY & COMPLIANCE

## 9.1 AUTHENTICATION & AUTHORIZATION

### Row Level Security (RLS) Policies

**Already defined in Section 3, but key principles:**

1. **Public data is always readable** (lobbyists, cities, subjects)
2. **Users can only modify their own data** (profile, favorites)
3. **Lobbyists can only edit profiles they own**
4. **Analytics data only visible to profile owner**
5. **Admin role has elevated permissions**

### Session Management
```typescript
// src/middleware/auth.ts
import { supabase } from '@/lib/supabase';

export async function getSession(request: Request) {
  const authHeader = request.headers.get('Authorization');
  if (!authHeader) return null;

  const token = authHeader.replace('Bearer ', '');
  const { data: { user }, error } = await supabase.auth.getUser(token);

  if (error || !user) return null;

  return { user };
}

export async function requireAuth(request: Request) {
  const session = await getSession(request);
  if (!session) {
    throw new Response('Unauthorized', { status: 401 });
  }
  return session;
}

export async function requireLobbyist(request: Request) {
  const session = await requireAuth(request);
  
  const { data: user } = await supabase
    .from('users')
    .select('role')
    .eq('id', session.user.id)
    .single();

  if (user?.role !== 'lobbyist') {
    throw new Response('Forbidden', { status: 403 });
  }

  return session;
}
```

## 9.2 INPUT VALIDATION

### Zod Schemas
```typescript
// src/lib/schemas.ts
import { z } from 'zod';

// User registration
export const signupSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  role: z.enum(['searcher', 'lobbyist'])
});

// Lobbyist profile update
export const lobbyistProfileSchema = z.object({
  bio: z.string().max(2000, 'Bio must be less than 2000 characters').optional(),
  email: z.string().email().optional(),
  phone: z.string().regex(/^\(\d{3}\)\d{3}-\d{4}$/, 'Invalid phone format').optional(),
  website: z.string().url('Invalid URL').optional(),
  linkedin: z.string().url('Invalid LinkedIn URL').optional(),
  cities_served: z.array(z.number()).optional(),
  subject_areas: z.array(z.number()).optional()
});

// Search filters
export const searchFiltersSchema = z.object({
  query: z.string().max(100).optional(),
  cityIds: z.array(z.number()).optional(),
  subjectAreaIds: z.array(z.number()).optional(),
  listingTier: z.array(z.enum(['free', 'premium', 'featured'])).optional(),
  limit: z.number().min(1).max(100).default(20),
  offset: z.number().min(0).default(0)
});

// Lead magnet form
export const leadMagnetSchema = z.object({
  name: z.string().min(2, 'Name is required'),
  email: z.string().email('Invalid email address'),
  guide: z.string()
});
```

### Usage in Forms
```tsx
// src/components/react/ProfileEditForm.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { lobbyistProfileSchema } from '@/lib/schemas';

export default function ProfileEditForm({ lobbyist }) {
  const form = useForm({
    resolver: zodResolver(lobbyistProfileSchema),
    defaultValues: lobbyist
  });

  const onSubmit = async (data) => {
    try {
      await updateLobbyistProfile(lobbyist.id, data);
      toast.success('Profile updated successfully');
    } catch (error) {
      toast.error('Failed to update profile');
    }
  };

  return (
    <form onSubmit={form.handleSubmit(onSubmit)}>
      {/* Form fields */}
    </form>
  );
}
```

## 9.3 DATA PRIVACY & COMPLIANCE

### Privacy Policy Requirements
```markdown
# Privacy Policy

## Data Collection
We collect:
- Account information (email, name)
- Profile information (for lobbyists)
- Search history (for logged-in users)
- Analytics data (anonymized via Plausible)
- Payment information (processed by Stripe, not stored)

## Data Usage
- Provide directory services
- Improve user experience
- Send transactional emails
- Process payments

## Data Sharing
- We do NOT sell your data
- Public lobbyist data is sourced from Texas Ethics Commission
- Payment processing by Stripe (PCI compliant)

## Your Rights
- Access your data
- Delete your account
- Opt out of marketing emails
- Request data export

## Contact
privacy@texaslobby.org
```

### Cookie Consent
```tsx
// src/components/react/CookieConsent.tsx
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';

export default function CookieConsent() {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const consent = localStorage.getItem('cookie-consent');
    if (!consent) {
      setShow(true);
    }
  }, []);

  const accept = () => {
    localStorage.setItem('cookie-consent', 'accepted');
    setShow(false);
  };

  if (!show) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 z-50">
      <div className="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
        <p className="text-sm">
          We use cookies to improve your experience. By using our site, you agree to our use of cookies.
          <a href="/privacy" className="underline ml-2">Learn more</a>
        </p>
        <Button onClick={accept} variant="outline">
          Accept
        </Button>
      </div>
    </div>
  );
}
```

## 9.4 RATE LIMITING

### API Rate Limiting
```typescript
// src/middleware/rateLimit.ts
import { LRUCache } from 'lru-cache';

type RateLimitOptions = {
  uniqueTokenPerInterval?: number;
  interval?: number;
};

export function rateLimit(options?: RateLimitOptions) {
  const tokenCache = new LRUCache({
    max: options?.uniqueTokenPerInterval || 500,
    ttl: options?.interval || 60000,
  });

  return {
    check: async (request: Request, limit: number) => {
      const ip = request.headers.get('x-forwarded-for') || 'anonymous';
      const tokenCount = (tokenCache.get(ip) as number[]) || [0];
      
      if (tokenCount[0] === 0) {
        tokenCache.set(ip, tokenCount);
      }
      
      tokenCount[0] += 1;

      const currentUsage = tokenCount[0];
      const isRateLimited = currentUsage >= limit;

      return {
        isRateLimited,
        remaining: limit - currentUsage,
        limit
      };
    }
  };
}

// Usage in API routes
const limiter = rateLimit({
  interval: 60 * 1000, // 1 minute
  uniqueTokenPerInterval: 500
});

export const POST: APIRoute = async ({ request }) => {
  const limitResult = await limiter.check(request, 10); // 10 requests per minute
  
  if (limitResult.isRateLimited) {
    return new Response('Rate limit exceeded', { status: 429 });
  }

  // Handle request
};
```

## 9.5 SECURITY HEADERS
```typescript
// netlify.toml
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"
    Content-Security-Policy = """
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://plausible.io https://js.stripe.com;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src 'self' https://fonts.gstatic.com;
      img-src 'self' data: https: blob:;
      connect-src 'self' https://*.supabase.co https://api.stripe.com https://plausible.io;
      frame-src https://js.stripe.com;
    """
```

---

# 10. TESTING REQUIREMENTS

## 10.1 UNIT TESTS

### Test Framework Setup
```bash
npm install -D vitest @testing-library/react @testing-library/jest-dom
```
```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/test/setup.ts'
  }
});
```

### Example Unit Tests
```typescript
// src/lib/api/__tests__/lobbyists.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { searchLobbyists } from '../lobbyists';

describe('searchLobbyists', () => {
  beforeEach(() => {
    // Setup test data
  });

  it('should return lobbyists matching query', async () => {
    const result = await searchLobbyists({ query: 'healthcare' });
    expect(result.lobbyists.length).toBeGreaterThan(0);
    expect(result.lobbyists[0].subject_areas).toContain('Healthcare');
  });

  it('should filter by city', async () => {
    const result = await searchLobbyists({ cityIds: [1] }); // Houston
    expect(result.lobbyists.every(l => l.cities_served.includes(1))).toBe(true);
  });

  it('should respect pagination', async () => {
    const result = await searchLobbyists({ limit: 10, offset: 0 });
    expect(result.lobbyists.length).toBeLessThanOrEqual(10);
  });

  it('should prioritize featured listings', async () => {
    const result = await searchLobbyists({});
    const firstTier = result.lobbyists[0].listing_tier;
    expect(['featured', 'premium']).toContain(firstTier);
  });
});
```
```typescript
// src/components/react/__tests__/SearchFilter.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import SearchFilter from '../SearchFilter';

describe('SearchFilter', () => {
  const mockOnSearch = vi.fn();
  const mockCities = [
    { id: 1, name: 'Houston' },
    { id: 2, name: 'Dallas' }
  ];
  const mockSubjects = [
    { id: 1, name: 'Healthcare', icon: 'heart' },
    { id: 2, name: 'Energy', icon: 'zap' }
  ];

  it('should render search input', () => {
    render(<SearchFilter cities={mockCities} subjectAreas={mockSubjects} onSearch={mockOnSearch} />);
    expect(screen.getByPlaceholderText(/search by name/i)).toBeInTheDocument();
  });

  it('should call onSearch when search button clicked', () => {
    render(<SearchFilter cities={mockCities} subjectAreas={mockSubjects} onSearch={mockOnSearch} />);
    const input = screen.getByPlaceholderText(/search by name/i);
    const button = screen.getByText(/search lobbyists/i);

    fireEvent.change(input, { target: { value: 'healthcare' } });
    fireEvent.click(button);

    expect(mockOnSearch).toHaveBeenCalledWith({
      query: 'healthcare',
      cityIds: [],
      subjectAreaIds: []
    });
  });

  it('should allow selecting multiple cities', () => {
    render(<SearchFilter cities={mockCities} subjectAreas={mockSubjects} onSearch={mockOnSearch} />);
    
    // Open filters
    fireEvent.click(screen.getByText(/filters/i));
    
    // Select cities
    fireEvent.click(screen.getByLabelText('Houston'));
    fireEvent.click(screen.getByLabelText('Dallas'));
    
    // Search
    fireEvent.click(screen.getByText(/search lobbyists/i));

    expect(mockOnSearch).toHaveBeenCalledWith({
      query: '',
      cityIds: [1, 2],
      subjectAreaIds: []
    });
  });
});
```

## 10.2 INTEGRATION TESTS

### Database Integration Tests
```typescript
// src/lib/api/__tests__/integration.test.ts
import { describe, it, expect, beforeAll, afterAll } from 'vitest';
import { supabase } from '@/lib/supabase';
import { claimLobbyist, updateLobbyistProfile } from '../lobbyists';

describe('Lobbyist Claim Flow', () => {
  let testUserId: string;
  let testLobbyistId: string;

  beforeAll(async () => {
    // Create test user
    const { data: { user } } = await supabase.auth.signUp({
      email: 'test@example.com',
      password: 'testpassword123'
    });
    testUserId = user!.id;

    // Create test lobbyist
    const { data: lobbyist } = await supabase
      .from('lobbyists')
      .insert({
        filer_id: 'TEST123',
        name: 'Test Lobbyist',
        claimed: false
      })
      .select()
      .single();
    testLobbyistId = lobbyist!.id;
  });

  afterAll(async () => {
    // Cleanup
    await supabase.from('lobbyists').delete().eq('id', testLobbyistId);
    await supabase.auth.admin.deleteUser(testUserId);
  });

  it('should allow user to claim unclaimed profile', async () => {
    const result = await claimLobbyist('TEST123', testUserId);
    expect(result.claimed).toBe(true);
    expect(result.user_id).toBe(testUserId);
  });

  it('should prevent claiming already claimed profile', async () => {
    await expect(
      claimLobbyist('TEST123', 'different-user-id')
    ).rejects.toThrow('already been claimed');
  });

  it('should allow owner to update profile', async () => {
    const updates = { bio: 'Updated bio' };
    const result = await updateLobbyistProfile(testLobbyistId, updates);
    expect(result.bio).toBe('Updated bio');
  });
});
```

## 10.3 E2E TESTS (PLAYWRIGHT)

### Setup
```bash
npm install -D @playwright/test
npx playwright install
```
```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:4321',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:4321',
    reuseExistingServer: !process.env.CI,
  },
});
```

### Example E2E Tests
```typescript
// e2e/search-flow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Search Flow', () => {
  test('should search for lobbyists by city', async ({ page }) => {
    await page.goto('/');
    
    // Open filters
    await page.click('text=Filters');
    
    // Select Houston
    await page.click('text=Houston');
    
    // Search
    await page.click('text=Search Lobbyists');
    
    // Verify results
    await expect(page.locator('.lobbyist-card')).toHaveCount({ min: 1 });
    await expect(page.locator('text=Houston, TX')).toBeVisible();
  });

  test('should filter by subject area', async ({ page }) => {
    await page.goto('/');
    
    await page.click('text=Filters');
    await page.click('text=Healthcare');
    await page.click('text=Search Lobbyists');
    
    // Verify healthcare badge appears
    await expect(page.locator('text=Healthcare').first()).toBeVisible();
  });

  test('should navigate to lobbyist profile', async ({ page }) => {
    await page.goto('/lobbyists');
    
    // Click first lobbyist card
    await page.click('.lobbyist-card >> nth=0');
    
    // Verify on profile page
    await expect(page).toHaveURL(/\/lobbyists\/\d+/);
    await expect(page.locator('h1')).toBeVisible();
  });
});

test.describe('Auth Flow', () => {
  test('should sign up new user', async ({ page }) => {
    await page.goto('/signup');
    
    await page.fill('input[name="email"]', 'test@example.com');
    await page.fill('input[name="password"]', 'password123');
    await page.click('text=Sign Up');
    
    // Should redirect to dashboard
    await expect(page).toHaveURL('/dashboard');
  });

  test('should allow lobbyist to claim profile', async ({ page, context }) => {
    // Login as lobbyist
    await page.goto('/login');
    await page.fill('input[name="email"]', 'lobbyist@example.com');
    await page.fill('input[name="password"]', 'password123');
    await page.click('text=Login');
    
    // Go to claim page
    await page.goto('/claim');
    
    // Search for profile
    await page.fill('input[placeholder*="Filer ID"]', '70358');
    await page.click('text=Search');
    
    // Claim profile
    await page.click('text=Claim This Profile');
    
    // Verify success
    await expect(page.locator('text=Profile claimed successfully')).toBeVisible();
  });
});

test.describe('Payment Flow', () => {
  test('should upgrade to premium listing', async ({ page }) => {
    // Login as lobbyist
    await page.goto('/login');
    await page.fill('input[name="email"]', 'lobbyist@example.com');
    await page.fill('input[name="password"]', 'password123');
    await page.click('text=Login');
    
    // Go to pricing
    await page.goto('/pricing');
    
    // Click upgrade for Premium
    await page.click('text=Upgrade to Premium');
    
    // Should redirect to Stripe Checkout
    await expect(page).toHaveURL(/checkout\.stripe\.com/);
  });
});
```

## 10.4 ACCESSIBILITY TESTS
```typescript
// e2e/accessibility.spec.ts
import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test.describe('Accessibility', () => {
  test('homepage should not have accessibility violations', async ({ page }) => {
    await page.goto('/');
    
    const accessibilityScanResults = await new AxeBuilder({ page }).analyze();
    
    expect(accessibilityScanResults.violations).toEqual([]);
  });

  test('search results should be keyboard navigable', async ({ page }) => {
    await page.goto('/lobbyists');
    
    // Tab through results
    await page.keyboard.press('Tab');
    await page.keyboard.press('Tab');
    
    // Should focus on first result
    const focused = await page.evaluate(() => document.activeElement?.textContent);
    expect(focused).toBeTruthy();
  });

  test('should have proper ARIA labels', async ({ page }) => {
    await page.goto('/');
    
    // Check search input has label
    const searchInput = page.locator('input[type="text"]');
    await expect(searchInput).toHaveAttribute('aria-label');
    
    // Check buttons have accessible names
    const searchButton = page.locator('button', { hasText: 'Search' });
    await expect(searchButton).toBeVisible();
  });
});
```

## 10.5 PERFORMANCE TESTS
```typescript
// e2e/performance.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Performance', () => {
  test('homepage should load within 3 seconds', async ({ page }) => {
    const startTime = Date.now();
    await page.goto('/');
    const loadTime = Date.now() - startTime;
    
    expect(loadTime).toBeLessThan(3000);
  });

  test('should achieve good Lighthouse scores', async ({ page }) => {
    await page.goto('/');
    
    // Run Lighthouse
    const { lhr } = await page.evaluate(async () => {
      const { default: lighthouse } = await import('lighthouse');
      const { lhr } = await lighthouse(location.href);
      return { lhr };
    });
    
    expect(lhr.categories.performance.score).toBeGreaterThan(0.9);
    expect(lhr.categories.accessibility.score).toBeGreaterThan(0.9);
    expect(lhr.categories.seo.score).toBeGreaterThan(0.9);
  });

  test('should lazy load images', async ({ page }) => {
    await page.goto('/lobbyists');
    
    // Check that images have loading="lazy"
    const images = await page.locator('img').all();
    for (const img of images) {
      const loading = await img.getAttribute('loading');
      expect(loading).toBe('lazy');
    }
  });
});
```

---

# 11. DEPLOYMENT & DEVOPS

## 11.1 ENVIRONMENT VARIABLES

### Required Environment Variables
```bash
# .env.example

# Public (exposed to client)
PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
PUBLIC_SITE_URL=https://texaslobby.org
PUBLIC_PLAUSIBLE_DOMAIN=texaslobby.org
PUBLIC_GOOGLE_SITE_VERIFICATION=xxxxx

# Private (server-only)
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
STRIPE_SECRET_KEY=sk_live_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx
STRIPE_PRICE_PREMIUM=price_xxxxx
STRIPE_PRICE_FEATURED=price_xxxxx
STRIPE_PRICE_SPONSORED=price_xxxxx
RESEND_API_KEY=re_xxxxx
DATABASE_URL=postgresql://user:pass@host:5432/db
```

### Netlify Environment Variables Setup
```bash
# Set via Netlify CLI or dashboard
netlify env:set PUBLIC_SUPABASE_URL "https://xxxxx.supabase.co"
netlify env:set PUBLIC_SUPABASE_ANON_KEY "eyJhbGci..."
netlify env:set SUPABASE_SERVICE_ROLE_KEY "eyJhbGci..."
netlify env:set STRIPE_SECRET_KEY "sk_live_xxxxx"
netlify env:set STRIPE_WEBHOOK_SECRET "whsec_xxxxx"
netlify env:set RESEND_API_KEY "re_xxxxx"
```

## 11.2 BUILD CONFIGURATION

### package.json Scripts
```json
{
  "scripts": {
    "dev": "astro dev",
    "build": "astro build",
    "preview": "astro preview",
    "test": "vitest",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "lint": "eslint . --ext .js,.jsx,.ts,.tsx,.astro",
    "format": "prettier --write .",
    "db:migrate": "supabase db push",
    "db:seed": "supabase db seed",
    "type-check": "tsc --noEmit"
  }
}
```

### netlify.toml
```toml
[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "20"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  conditions = {Role = ["!public"]}

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[dev]
  command = "astro dev"
  port = 4321
  publish = "dist"
  autoLaunch = true
```

## 11.3 CI/CD PIPELINE

### GitHub Actions Workflow
```yaml
# .github/workflows/main.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run lint
      - run: npm run type-check

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run test
        env:
          PUBLIC_SUPABASE_URL: ${{ secrets.PUBLIC_SUPABASE_URL }}
          PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.PUBLIC_SUPABASE_ANON_KEY }}

  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npx playwright install --with-deps
      - run: npm run build
      - run: npm run test:e2e
        env:
          PUBLIC_SUPABASE_URL: ${{ secrets.PUBLIC_SUPABASE_URL }}
          PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.PUBLIC_SUPABASE_ANON_KEY }}
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30

  deploy:
    needs: [lint, test, e2e]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run build
        env:
          PUBLIC_SUPABASE_URL: ${{ secrets.PUBLIC_SUPABASE_URL }}
          PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.PUBLIC_SUPABASE_ANON_KEY }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          STRIPE_SECRET_KEY: ${{ secrets.STRIPE_SECRET_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v2
        with:
          publish-dir: './dist'
          production-deploy: true
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
```

## 11.4 DATABASE MIGRATIONS

### Supabase Migration Workflow
```bash
# Create a new migration
supabase migration new add_analytics_table

# Apply migrations locally
supabase db reset

# Push to production
supabase db push --db-url $PRODUCTION_DATABASE_URL
```

### Example Migration
```sql
-- supabase/migrations/20240115_add_analytics.sql

-- Add page_views table for analytics
CREATE TABLE IF NOT EXISTS page_views (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  lobbyist_id UUID REFERENCES lobbyists(id) ON DELETE CASCADE,
  viewer_type TEXT CHECK (viewer_type IN ('anonymous', 'authenticated')),
  referrer TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_page_views_lobbyist_id ON page_views(lobbyist_id);
CREATE INDEX idx_page_views_created_at ON page_views(created_at DESC);

-- RLS policies
ALTER TABLE page_views ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can create page views"
  ON page_views FOR INSERT
  WITH CHECK (true);

CREATE POLICY "Lobbyists can view own page views"
  ON page_views FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM lobbyists
      WHERE lobbyists.id = page_views.lobbyist_id
      AND lobbyists.user_id = auth.uid()
    )
  );
```

## 11.5 MONITORING & ALERTING

### Error Tracking (Sentry)
```typescript
// src/lib/sentry.ts
import * as Sentry from '@sentry/astro';

Sentry.init({
  dsn: import.meta.env.PUBLIC_SENTRY_DSN,
  environment: import.meta.env.MODE,
  tracesSampleRate: 1.0,
  integrations: [
    new Sentry.BrowserTracing(),
    new Sentry.Replay()
  ],
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0
});
```

### Health Check Endpoint
```typescript
// src/pages/api/health.ts
import type { APIRoute } from 'astro';
import { supabase } from '@/lib/supabase';

export const GET: APIRoute = async () => {
  try {
    // Check database connection
    const { error } = await supabase.from('lobbyists').select('count').limit(1);
    
    if (error) throw error;

    return new Response(JSON.stringify({
      status: 'healthy',
      timestamp: new Date().toISOString(),
      services: {
        database: 'up',
        api: 'up'
      }
    }), {
      status: 200,
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (error) {
    return new Response(JSON.stringify({
      status: 'unhealthy',
      timestamp: new Date().toISOString(),
      error: error.message
    }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' }
    });
  }
};
```

### Uptime Monitoring

Use services like:
- **UptimeRobot** - Free tier monitors every 5 minutes
- **Pingdom** - More advanced monitoring
- **Better Uptime** - Status page + monitoring

Configure to hit `/api/health` every 5 minutes and alert if down.

---

# 12. ANALYTICS & TRACKING

## 12.1 KEY METRICS TO TRACK

### Business Metrics
1. **Revenue**
   - MRR (Monthly Recurring Revenue)
   - ARR (Annual Recurring Revenue)
   - ARPU (Average Revenue Per User)
   - Churn rate

2. **Growth**
   - New signups (searchers)
   - New lobbyist registrations
   - Conversion rate (free → paid)
   - Upgrade rate (premium → featured)

3. **Engagement**
   - Daily/Weekly/Monthly Active Users
   - Search volume
   - Profile views
   - Time on site
   - Pages per session

### SEO Metrics
1. **Rankings**
   - Keyword positions (track top 50 keywords)
   - Featured snippets captured
   - Local pack appearances

2. **Traffic**
   - Organic search traffic
   - Direct traffic
   - Referral traffic
   - Branded vs non-branded search

3. **Technical**
   - Core Web Vitals (LCP, FID, CLS)
   - Mobile usability score
   - Index coverage
   - Crawl errors

### User Behavior Metrics
1. **Searches**
   - Top search queries
   - Filter usage
   - Zero-result searches
   - Search refinement rate

2. **Conversions**
   - Lead magnet downloads
   - Contact form submissions
   - Upgrade clicks
   - Trial starts

3. **Retention**
   - Return visitor rate
   - Favorite usage
   - Saved search usage

## 12.2 DASHBOARD IMPLEMENTATION

### Admin Analytics Dashboard
```tsx
// src/pages/admin/analytics.astro
---
import Layout from '@/components/astro/Layout.astro';
import { supabase } from '@/lib/supabase';

// Fetch metrics
const { data: metrics } = await supabase.rpc('get_admin_metrics');
---

<Layout title="Analytics Dashboard">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Analytics Dashboard</h1>

    {/* Revenue Metrics */}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow p-6">
        <p class="text-gray-600 text-sm mb-2">MRR</p>
        <p class="text-3xl font-bold text-primary-500">${metrics.mrr}</p>
        <p class="text-sm text-green-600 mt-2">↑ 12% from last month</p>
      </div>
      
      <div class="bg-white rounded-lg shadow p-6">
        <p class="text-gray-600 text-sm mb-2">Total Lobbyists</p>
        <p class="text-3xl font-bold text-primary-500">{metrics.total_lobbyists}</p>
        <p class="text-sm text-green-600 mt-2">↑ 8 this month</p>
      </div>

      <div class="bg-white rounded-lg shadow p-6">
        <p class="text-gray-600 text-sm mb-2">Paid Listings</p>
        <p class="text-3xl font-bold text-primary-500">{metrics.paid_listings}</p>
        <p class="text-sm text-gray-600 mt-2">{(metrics.paid_listings / metrics.total_lobbyists * 100).toFixed(1)}% conversion</p>
      </div>

      <div class="bg-white rounded-lg shadow p-6">
        <p class="text-gray-600 text-sm mb-2">Churn Rate</p>
        <p class="text-3xl font-bold text-red-500">{metrics.churn_rate}%</p>
        <p class="text-sm text-green-600 mt-2">↓ 2% from last month</p>
      </div>
    </div>

    {/* Charts would go here */}
  </div>
</Layout>
```

### Lobbyist Analytics Dashboard
```tsx
// src/components/react/LobbyistAnalytics.tsx
import { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer } from 'recharts';

export default function LobbyistAnalytics({ lobbyistId }) {
  const [analytics, setAnalytics] = useState(null);

  useEffect(() => {
    async function loadAnalytics() {
      const data = await getLobbyistAnalytics(lobbyistId, 30);
      setAnalytics(data);
    }
    loadAnalytics();
  }, [lobbyistId]);

  if (!analytics) return <div>Loading...</div>;

  return (
    <div className="space-y-6">
      {/* Key Metrics */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>Total Views (30 days)</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-4xl font-bold text-primary-500">
              {analytics.totalViews}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Anonymous Viewers</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-4xl font-bold text-gray-700">
              {analytics.viewsByType.anonymous}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Authenticated Viewers</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-4xl font-bold text-gray-700">
              {analytics.viewsByType.authenticated}
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Views Over Time Chart */}
      <Card>
        <CardHeader>
          <CardTitle>Views Over Time</CardTitle>
        </CardHeader>
        <CardContent>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={analytics.viewsByDay}>
              <XAxis dataKey="date" />
              <YAxis />
              <Tooltip />
              <Line type="monotone" dataKey="views" stroke="#003f87" strokeWidth={2} />
            </LineChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>

      {/* Top Referrers */}
      <Card>
        <CardHeader>
          <CardTitle>Top Traffic Sources</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {analytics.topReferrers.map((referrer, idx) => (
              <div key={idx} className="flex justify-between items-center">
                <span className="text-gray-700">{referrer.source || 'Direct'}</span>
                <span className="font-semibold">{referrer.count} views</span>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

## 12.3 CONVERSION FUNNEL TRACKING

### Define Funnels
```typescript
// src/lib/funnels.ts

export const FUNNELS = {
  SEARCHER_SIGNUP: [
    'homepage_visit',
    'search_performed',
    'profile_viewed',
    'signup_clicked',
    'signup_completed'
  ],
  
  LOBBYIST_UPGRADE: [
    'profile_claimed',
    'dashboard_visited',
    'pricing_viewed',
    'upgrade_clicked',
    'payment_completed'
  ],
  
  LEAD_MAGNET: [
    'guide_page_visit',
    'form_viewed',
    'form_submitted',
    'download_completed'
  ]
};

export function trackFunnelStep(funnel: string, step: string, metadata?: any) {
  // Track in Plausible
  plausible(`Funnel: ${funnel} - ${step}`, { props: metadata });
  
  // Track in database for detailed analysis
  supabase.from('funnel_events').insert({
    funnel,
    step,
    metadata,
    timestamp: new Date().toISOString()
  });
}
```

## 12.4 A/B TESTING FRAMEWORK

### Simple Feature Flag System
```typescript
// src/lib/experiments.ts
export const EXPERIMENTS = {
  HERO_CTA_TEXT: {
    control: 'Find Your Lobbyist',
    variant_a: 'Search Lobbyists Now',
    variant_b: 'Get Started'
  },
  PRICING_PAGE_LAYOUT: {
    control: 'horizontal',
    variant_a: 'vertical'
  }
};

export function getExperimentVariant(experimentId: string, userId?: string): string {
  // Hash user ID to consistently assign variant
  const hash = userId ? simpleHash(userId) : Math.random();
  const variants = Object.keys(EXPERIMENTS[experimentId]);
  const index = Math.floor(hash * variants.length);
  return variants[index];
}

function simpleHash(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = ((hash << 5) - hash) + str.charCodeAt(i);
    hash |= 0;
  }
  return Math.abs(hash) / Number.MAX_SAFE_INTEGER;
}
```

---

# SUMMARY & HANDOFF CHECKLIST

## What We're Building
**TexasLobby.org** - A modern, searchable directory connecting Texas business owners with experienced lobbyists. Premium positioning with StoryBrand messaging framework.

## Tech Stack
- **Frontend**: Astro + React + Tailwind + shadcn/ui
- **Backend**: Supabase (PostgreSQL + Auth + Storage)
- **Payments**: Stripe
- **Email**: Resend
- **Analytics**: Plausible
- **Hosting**: Netlify

## Key Features
1. Search/filter lobbyists by city, subject area, keyword
2. Detailed lobbyist profiles with clients, expertise, contact info
3. User accounts with favorites and saved searches
4. Lobbyist claim & edit profiles
5. Tiered listings (Free, Premium $297/mo, Featured $597/mo)
6. Analytics dashboard for Featured lobbyists
7. Educational content (guides, blog)
8. SEO-optimized city and subject landing pages

## Development Phases

### Phase 1: MVP (Weeks 1-6)
- [ ] Database schema & migrations
- [ ] Authentication system
- [ ] Homepage with search
- [ ] Lobbyist directory & profiles
- [ ] 5 city pages
- [ ] 10 subject area pages
- [ ] Claim profile flow
- [ ] Stripe integration
- [ ] 2 educational guides

### Phase 2: Growth (Weeks 7-12)
- [ ] User dashboard
- [ ] Favorites & comparison
- [ ] 20 more city pages
- [ ] 10 more subject pages
- [ ] Analytics dashboard for Featured
- [ ] Blog system
- [ ] Email automation
- [ ] Lead magnets

### Phase 3: Scale (Weeks 13-18)
- [ ] Advanced filters
- [ ] All Texas cities (100+)
- [ ] City/subject combinations
- [ ] Interactive tools
- [ ] API for researchers
- [ ] Mobile app (PWA)

## Critical Files to Create First

1. **Database Setup**
   - `supabase/migrations/001_initial_schema.sql`
   - `supabase/seed.sql`

2. **Core Config**
   - `.env.example`
   - `astro.config.mjs`
   - `tailwind.config.mjs`
   - `tsconfig.json`

3. **Layout & Components**
   - `src/components/astro/Layout.astro`
   - `src/components/astro/SEO.astro`
   - `src/components/react/SearchFilter.tsx`
   - `src/components/react/LobbyistCard.tsx`

4. **Pages**
   - `src/pages/index.astro` (homepage)
   - `src/pages/lobbyists/index.astro` (directory)
   - `src/pages/lobbyists/[slug].astro` (profile)

5. **API Layer**
   - `src/lib/supabase.ts`
   - `src/lib/api/lobbyists.ts`
   - `src/lib/stripe.ts`

## Success Criteria

### Technical
- [ ] Lighthouse score 90+ on all pages
- [ ] Sub-3-second page loads
- [ ] Mobile responsive
- [ ] SEO schema markup on all pages
- [ ] Passing E2E tests

### Business
- [ ] 50 claimed lobbyist profiles
- [ ] 25 paid subscriptions
- [ ] 1,000 organic visits/day
- [ ] 10 educational guides published
- [ ] Rank page 1 for "texas lobbyists"

## Questions for Product Team

1. Do we have access to Google Sheets with source data?
2. Have we set up Stripe account with products?
3. Do we have content writers for guides?
4. What's the budget for Google Ads during launch?
5. Do we need legal review of Terms of Service?

---

**This documentation provides everything needed to build TexasLobby.org from A to Z. Each section contains detailed specifications, code examples, and acceptance criteria. The lead engineer (Claude Code) should follow this sequentially, starting with database setup, then core features, then growth features.**RetryClaude can make mistakes. Please double-check responses.